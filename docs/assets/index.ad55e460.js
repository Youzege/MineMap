import{C as lr,r as hr,d as ur,u as Oe,l as Re,M as fr,o as cr,e as dr,f as At,B as pn,E as Zt,g as mt,h as pr,i as vt,j as _n,k as _r,m as vr,n as gr,p as yr,G as Qe,q as zt,s as mr,t as w,v as xr,w as Er,S as Sr,x as tt,y as ki,z as Ir,A as Ct,I as j,D as vn,F as ft,H as Mt,J as Qt,K as te,L as ee,N as Tr,O as Cr,P as Or,Q as Rr,R as wr,T as bi,U as Bi,V as Lr,W as we,X as ie,Y as ne,Z as Ne,$ as Dr,a0 as pi,a1 as Fr,a2 as it,a3 as It,a4 as re,a5 as Le,a6 as gn,a7 as Pr,a8 as X,a9 as Ar,aa as De,ab as Mr,ac as Nr,ad as kr,ae as Fe,af as Ft,ag as hi,ah as br,ai as Kt,aj as Br,ak as Gi,al as Pe,am as Gr,an as ui,ao as Ae,ap as Yr,aq as Wr,ar as Xr,as as Ur,at as Yi,au as Wi,av as ve,aw as ge,ax as $r,ay as Hr,az as Vr,aA as jr,aB as zr,aC as Jr,aD as qr,aE as Kr,aF as Zr,aG as yn,aH as mn,aI as Qr,aJ as ta,aK as ea,aL as ia,aM as Xi,aN as na,aO as ra,aP as aa,aQ as xn,aR as Nt,aS as sa,_ as oa,a as la,b as ha,c as ua}from"./ZeView.3c503e5d.js";import{_ as fa}from"./index.ff58d53e.js";import{L as ca,D as St,M as da,N as pa,O as _a,P as va,o as _i,c as En,w as K,d as $,C as Ot,t as Et,l as ga,m as ya,b as Ui,J as ma,H as xa,a as Ea,j as Sa}from"./vendor.044c0d55.js";var J={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},Ia=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),U={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},Ta=function(r){Ia(e,r);function e(t){var i=r.call(this)||this;i.on,i.once,i.un,i.options=t,i.id=t.id,i.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,i.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,i.element=document.createElement("div"),i.element.className=t.className!==void 0?t.className:"ol-overlay-container "+lr,i.element.style.position="absolute",i.element.style.pointerEvents="auto";var n=t.autoPan;return n&&typeof n!="object"&&(n={animation:t.autoPanAnimation,margin:t.autoPanMargin}),i.autoPan=n||!1,i.rendered={transform_:"",visible:!0},i.mapPostrenderListenerKey=null,i.addChangeListener(U.ELEMENT,i.handleElementChanged),i.addChangeListener(U.MAP,i.handleMapChanged),i.addChangeListener(U.OFFSET,i.handleOffsetChanged),i.addChangeListener(U.POSITION,i.handlePositionChanged),i.addChangeListener(U.POSITIONING,i.handlePositioningChanged),t.element!==void 0&&i.setElement(t.element),i.setOffset(t.offset!==void 0?t.offset:[0,0]),i.setPositioning(t.positioning!==void 0?t.positioning:J.TOP_LEFT),t.position!==void 0&&i.setPosition(t.position),i}return e.prototype.getElement=function(){return this.get(U.ELEMENT)},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(U.MAP)},e.prototype.getOffset=function(){return this.get(U.OFFSET)},e.prototype.getPosition=function(){return this.get(U.POSITION)},e.prototype.getPositioning=function(){return this.get(U.POSITIONING)},e.prototype.handleElementChanged=function(){hr(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(ur(this.element),Oe(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=Re(t,fr.POSTRENDER,this.render,this),this.updatePixelPosition();var i=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(U.ELEMENT,t)},e.prototype.setMap=function(t){this.set(U.MAP,t)},e.prototype.setOffset=function(t){this.set(U.OFFSET,t)},e.prototype.setPosition=function(t){this.set(U.POSITION,t)},e.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},e.prototype.panIntoView=function(t){var i=this.getMap();if(!(!i||!i.getTargetElement()||!this.get(U.POSITION))){var n=this.getRect(i.getTargetElement(),i.getSize()),a=this.getElement(),s=this.getRect(a,[cr(a),dr(a)]),o=t||{},l=o.margin===void 0?20:o.margin;if(!At(n,s)){var h=s[0]-n[0],u=n[2]-s[2],f=s[1]-n[1],c=n[3]-s[3],d=[0,0];if(h<0?d[0]=h-l:u<0&&(d[0]=Math.abs(u)+l),f<0?d[1]=f-l:c<0&&(d[1]=Math.abs(c)+l),d[0]!==0||d[1]!==0){var p=i.getView().getCenterInternal(),_=i.getPixelFromCoordinateInternal(p);if(!_)return;var v=[_[0]+d[0],_[1]+d[1]],g=o.animation||{};i.getView().animateInternal({center:i.getCoordinateFromPixelInternal(v),duration:g.duration,easing:g.easing})}}}},e.prototype.getRect=function(t,i){var n=t.getBoundingClientRect(),a=n.left+window.pageXOffset,s=n.top+window.pageYOffset;return[a,s,a+i[0],s+i[1]]},e.prototype.setPositioning=function(t){this.set(U.POSITIONING,t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),i=this.getPosition();if(!t||!t.isRendered()||!i){this.setVisible(!1);return}var n=t.getPixelFromCoordinate(i),a=t.getSize();this.updateRenderedPosition(n,a)},e.prototype.updateRenderedPosition=function(t,i){var n=this.element.style,a=this.getOffset(),s=this.getPositioning();this.setVisible(!0);var o=Math.round(t[0]+a[0])+"px",l=Math.round(t[1]+a[1])+"px",h="0%",u="0%";s==J.BOTTOM_RIGHT||s==J.CENTER_RIGHT||s==J.TOP_RIGHT?h="-100%":(s==J.BOTTOM_CENTER||s==J.CENTER_CENTER||s==J.TOP_CENTER)&&(h="-50%"),s==J.BOTTOM_LEFT||s==J.BOTTOM_CENTER||s==J.BOTTOM_RIGHT?u="-100%":(s==J.CENTER_LEFT||s==J.CENTER_CENTER||s==J.CENTER_RIGHT)&&(u="-50%");var f="translate("+h+", "+u+") translate("+o+", "+l+")";this.rendered.transform_!=f&&(this.rendered.transform_=f,n.transform=f,n.msTransform=f)},e.prototype.getOptions=function(){return this.options},e}(pn),Ca=Ta,Ht={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},Oa=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ra=function(r){Oa(e,r);function e(t){var i=r.call(this)||this;if(i.on,i.once,i.un,i.id_=void 0,i.geometryName_="geometry",i.style_=null,i.styleFunction_=void 0,i.geometryChangeKey_=null,i.addChangeListener(i.geometryName_,i.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){var n=t;i.setGeometry(n)}else{var a=t;i.setProperties(a)}return i}return e.prototype.clone=function(){var t=new e(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var i=this.getGeometry();i&&t.setGeometry(i.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.prototype.getId=function(){return this.id_},e.prototype.getGeometryName=function(){return this.geometryName_},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.handleGeometryChange_=function(){this.changed()},e.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(Oe(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=Re(t,Zt.CHANGE,this.handleGeometryChange_,this)),this.changed()},e.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?wa(t):void 0,this.changed()},e.prototype.setId=function(t){this.id_=t,this.changed()},e.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},e}(pn);function wa(r){if(typeof r=="function")return r;var e;if(Array.isArray(r))e=r;else{mt(typeof r.getZIndex=="function",41);var t=r;e=[t]}return function(){return e}}var ke=Ra;function La(r,e,t,i,n,a,s){var o,l,h=(t-e)/i;if(h===1)o=e;else if(h===2)o=e,l=n;else if(h!==0){for(var u=r[e],f=r[e+1],c=0,d=[0],p=e+i;p<t;p+=i){var _=r[p],v=r[p+1];c+=Math.sqrt((_-u)*(_-u)+(v-f)*(v-f)),d.push(c),u=_,f=v}var g=n*c,y=pr(d,g);y<0?(l=(g-d[-y-2])/(d[-y-1]-d[-y-2]),o=e+(-y-2)*i):o=e+y*i}for(var x=s>1?s:2,E=a||new Array(x),p=0;p<x;++p)E[p]=o===void 0?NaN:l===void 0?r[o+p]:vt(r[o+p],r[o+i+p],l);return E}function Da(r,e,t,i,n,a){if(t==e)return null;var s;if(n<r[e+i-1])return a?(s=r.slice(e,e+i),s[i-1]=n,s):null;if(r[t-1]<n)return a?(s=r.slice(t-i,t),s[i-1]=n,s):null;if(n==r[e+i-1])return r.slice(e,e+i);for(var o=e/i,l=t/i;o<l;){var h=o+l>>1;n<r[(h+1)*i-1]?l=h:o=h+1}var u=r[o*i-1];if(n==u)return r.slice((o-1)*i,(o-1)*i+i);var f=r[(o+1)*i-1],c=(n-u)/(f-u);s=[];for(var d=0;d<i-1;++d)s.push(vt(r[(o-1)*i+d],r[o*i+d],c));return s.push(n),s}function Sn(r,e,t,i){for(var n=r[e],a=r[e+1],s=0,o=e+i;o<t;o+=i){var l=r[o],h=r[o+1];s+=Math.sqrt((l-n)*(l-n)+(h-a)*(h-a)),n=l,a=h}return s}var Fa=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Pa=function(r){Fa(e,r);function e(t,i){var n=r.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,i!==void 0&&!Array.isArray(t[0])?n.setFlatCoordinates(i,t):n.setCoordinates(t,i),n}return e.prototype.appendCoordinate=function(t){this.flatCoordinates?_n(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){var t=new e(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},e.prototype.closestPointXY=function(t,i,n,a){return a<_r(this.getExtent(),t,i)?a:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(vr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,i,n,a))},e.prototype.forEachSegment=function(t){return yr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,i){if(this.layout!=Qe.XYM&&this.layout!=Qe.XYZM)return null;var n=i!==void 0?i:!1;return Da(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n)},e.prototype.getCoordinates=function(){return zt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,i){return La(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,this.stride)},e.prototype.getLength=function(){return Sn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=mr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,Qe.XY)},e.prototype.getType=function(){return w.LINE_STRING},e.prototype.intersectsExtent=function(t){return xr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Er(this.flatCoordinates,0,t,this.stride),this.changed()},e}(Sr),Aa=Pa;function Ma(r,e,t,i,n){In(r,e,t||0,i||r.length-1,n||Na)}function In(r,e,t,i,n){for(;i>t;){if(i-t>600){var a=i-t+1,s=e-t+1,o=Math.log(a),l=.5*Math.exp(2*o/3),h=.5*Math.sqrt(o*l*(a-l)/a)*(s-a/2<0?-1:1),u=Math.max(t,Math.floor(e-s*l/a+h)),f=Math.min(i,Math.floor(e+(a-s)*l/a+h));In(r,e,u,f,n)}var c=r[e],d=t,p=i;for(Vt(r,t,e),n(r[i],c)>0&&Vt(r,t,i);d<p;){for(Vt(r,d,p),d++,p--;n(r[d],c)<0;)d++;for(;n(r[p],c)>0;)p--}n(r[t],c)===0?Vt(r,t,p):(p++,Vt(r,p,i)),p<=e&&(t=p+1),e<=p&&(i=p-1)}}function Vt(r,e,t){var i=r[e];r[e]=r[t],r[t]=i}function Na(r,e){return r<e?-1:r>e?1:0}class Tn{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!me(e,t))return i;const n=this.toBBox,a=[];for(;t;){for(let s=0;s<t.children.length;s++){const o=t.children[s],l=t.leaf?n(o):o;me(e,l)&&(t.leaf?i.push(o):ei(e,l)?this._all(o,i):a.push(o))}t=a.pop()}return i}collides(e){let t=this.data;if(!me(e,t))return!1;const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const a=t.children[n],s=t.leaf?this.toBBox(a):a;if(me(e,s)){if(t.leaf||ei(e,s))return!0;i.push(a)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Pt([]),this}remove(e,t){if(!e)return this;let i=this.data;const n=this.toBBox(e),a=[],s=[];let o,l,h;for(;i||a.length;){if(i||(i=a.pop(),l=a[a.length-1],o=s.pop(),h=!0),i.leaf){const u=ka(e,i.children,t);if(u!==-1)return i.children.splice(u,1),a.push(i),this._condense(a),this}!h&&!i.leaf&&ei(i,n)?(a.push(i),s.push(o),o=0,l=i,i=i.children[0]):l?(o++,i=l.children[o],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const a=i-t+1;let s=this._maxEntries,o;if(a<=s)return o=Pt(e.slice(t,i+1)),Rt(o,this.toBBox),o;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),o=Pt([]),o.leaf=!1,o.height=n;const l=Math.ceil(a/s),h=l*Math.ceil(Math.sqrt(s));$i(e,t,i,h,this.compareMinX);for(let u=t;u<=i;u+=h){const f=Math.min(u+h-1,i);$i(e,u,f,l,this.compareMinY);for(let c=u;c<=f;c+=l){const d=Math.min(c+l-1,f);o.children.push(this._build(e,c,d,n-1))}}return Rt(o,this.toBBox),o}_chooseSubtree(e,t,i,n){for(;n.push(t),!(t.leaf||n.length-1===i);){let a=1/0,s=1/0,o;for(let l=0;l<t.children.length;l++){const h=t.children[l],u=ti(h),f=Ga(e,h)-u;f<s?(s=f,a=u<a?u:a,o=h):f===s&&u<a&&(a=u,o=h)}t=o||t.children[0]}return t}_insert(e,t,i){const n=i?e:this.toBBox(e),a=[],s=this._chooseSubtree(n,this.data,t,a);for(s.children.push(e),qt(s,n);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(n,a,t)}_split(e,t){const i=e[t],n=i.children.length,a=this._minEntries;this._chooseSplitAxis(i,a,n);const s=this._chooseSplitIndex(i,a,n),o=Pt(i.children.splice(s,i.children.length-s));o.height=i.height,o.leaf=i.leaf,Rt(i,this.toBBox),Rt(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=Pt([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Rt(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,a=1/0,s=1/0;for(let o=t;o<=i-t;o++){const l=Jt(e,0,o,this.toBBox),h=Jt(e,o,i,this.toBBox),u=Ya(l,h),f=ti(l)+ti(h);u<a?(a=u,n=o,s=f<s?f:s):u===a&&f<s&&(s=f,n=o)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:ba,a=e.leaf?this.compareMinY:Ba,s=this._allDistMargin(e,t,i,n),o=this._allDistMargin(e,t,i,a);s<o&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const a=this.toBBox,s=Jt(e,0,t,a),o=Jt(e,i-t,i,a);let l=ye(s)+ye(o);for(let h=t;h<i-t;h++){const u=e.children[h];qt(s,e.leaf?a(u):u),l+=ye(s)}for(let h=i-t-1;h>=t;h--){const u=e.children[h];qt(o,e.leaf?a(u):u),l+=ye(o)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)qt(t[n],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Rt(e[t],this.toBBox)}}function ka(r,e,t){if(!t)return e.indexOf(r);for(let i=0;i<e.length;i++)if(t(r,e[i]))return i;return-1}function Rt(r,e){Jt(r,0,r.children.length,e,r)}function Jt(r,e,t,i,n){n||(n=Pt(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let a=e;a<t;a++){const s=r.children[a];qt(n,r.leaf?i(s):s)}return n}function qt(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function ba(r,e){return r.minX-e.minX}function Ba(r,e){return r.minY-e.minY}function ti(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function ye(r){return r.maxX-r.minX+(r.maxY-r.minY)}function Ga(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function Ya(r,e){const t=Math.max(r.minX,e.minX),i=Math.max(r.minY,e.minY),n=Math.min(r.maxX,e.maxX),a=Math.min(r.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,a-i)}function ei(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function me(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function Pt(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function $i(r,e,t,i,n){const a=[e,t];for(;a.length;){if(t=a.pop(),e=a.pop(),t-e<=i)continue;const s=e+Math.ceil((t-e)/i/2)*i;Ma(r,s,e,t,n),a.push(e,s,s,t)}}var Wa=function(){function r(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=ki(e.scale),this.displacement_=e.displacement}return r.prototype.clone=function(){var e=this.getScale();return new r({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},r.prototype.getOpacity=function(){return this.opacity_},r.prototype.getRotateWithView=function(){return this.rotateWithView_},r.prototype.getRotation=function(){return this.rotation_},r.prototype.getScale=function(){return this.scale_},r.prototype.getScaleArray=function(){return this.scaleArray_},r.prototype.getDisplacement=function(){return this.displacement_},r.prototype.getAnchor=function(){return tt()},r.prototype.getImage=function(e){return tt()},r.prototype.getHitDetectionImage=function(){return tt()},r.prototype.getPixelRatio=function(e){return 1},r.prototype.getImageState=function(){return tt()},r.prototype.getImageSize=function(){return tt()},r.prototype.getOrigin=function(){return tt()},r.prototype.getSize=function(){return tt()},r.prototype.setDisplacement=function(e){this.displacement_=e},r.prototype.setOpacity=function(e){this.opacity_=e},r.prototype.setRotateWithView=function(e){this.rotateWithView_=e},r.prototype.setRotation=function(e){this.rotation_=e},r.prototype.setScale=function(e){this.scale_=e,this.scaleArray_=ki(e)},r.prototype.listenImageChange=function(e){tt()},r.prototype.load=function(){tt()},r.prototype.unlistenImageChange=function(e){tt()},r}(),Cn=Wa;function rt(r){return Array.isArray(r)?Ir(r):r}var Xa=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ua=function(r){Xa(e,r);function e(t){var i=this,n=t.rotateWithView!==void 0?t.rotateWithView:!1;return i=r.call(this,{opacity:1,rotateWithView:n,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0]})||this,i.canvas_=void 0,i.hitDetectionCanvas_=null,i.fill_=t.fill!==void 0?t.fill:null,i.origin_=[0,0],i.points_=t.points,i.radius_=t.radius!==void 0?t.radius:t.radius1,i.radius2_=t.radius2,i.angle_=t.angle!==void 0?t.angle:0,i.stroke_=t.stroke!==void 0?t.stroke:null,i.size_=null,i.renderOptions_=null,i.render(),i}return e.prototype.clone=function(){var t=this.getScale(),i=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return i.setOpacity(this.getOpacity()),i},e.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var i=this.getDisplacement();return[t[0]/2-i[0],t[1]/2+i[1]]},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},e.prototype.getImage=function(t){var i=this.canvas_[t];if(!i){var n=this.renderOptions_,a=Ct(n.size*t,n.size*t);this.draw_(n,a,t),i=a.canvas,this.canvas_[t]=i}return i},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.size_},e.prototype.getImageState=function(){return j.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.calculateLineJoinSize_=function(t,i,n){if(i===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return i;var a=this.radius_,s=this.radius2_===void 0?a:this.radius2_;if(a<s){var o=a;a=s,s=o}var l=this.radius2_===void 0?this.points_:this.points_*2,h=2*Math.PI/l,u=s*Math.sin(h),f=Math.sqrt(s*s-u*u),c=a-f,d=Math.sqrt(u*u+c*c),p=d/u;if(t==="miter"&&p<=n)return p*i;var _=i/2/p,v=i/2*(c/d),g=Math.sqrt((a+_)*(a+_)+v*v),y=g-a;if(this.radius2_===void 0||t==="bevel")return y*2;var x=a*Math.sin(h),E=Math.sqrt(a*a-x*x),S=s-E,C=Math.sqrt(x*x+S*S),R=C/x;if(R<=n){var T=R*i/2-s-a;return 2*Math.max(y,T)}return y*2},e.prototype.createRenderOptions=function(){var t=Mt,i=0,n=null,a=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=Qt),s=rt(s),o=this.stroke_.getWidth(),o===void 0&&(o=te),n=this.stroke_.getLineDash(),a=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=Mt),i=this.stroke_.getMiterLimit(),i===void 0&&(i=ee));var l=this.calculateLineJoinSize_(t,o,i),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:s,strokeWidth:o,size:u,lineDash:n,lineDashOffset:a,lineJoin:t,miterLimit:i}},e.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},e.prototype.draw_=function(t,i,n){if(i.scale(n,n),i.translate(t.size/2,t.size/2),this.createPath_(i),this.fill_){var a=this.fill_.getColor();a===null&&(a=ft),i.fillStyle=rt(a),i.fill()}this.stroke_&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,i.setLineDash&&t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())},e.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var i=this.fill_.getColor(),n=0;if(typeof i=="string"&&(i=vn(i)),i===null?n=1:Array.isArray(i)&&(n=i.length===4?i[3]:1),n===0){var a=Ct(t.size,t.size);this.hitDetectionCanvas_=a.canvas,this.drawHitDetectionCanvas_(t,a)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},e.prototype.createPath_=function(t){var i=this.points_,n=this.radius_;if(i===1/0)t.arc(0,0,n,0,2*Math.PI);else{var a=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(i*=2);for(var s=this.angle_-Math.PI/2,o=2*Math.PI/i,l=0;l<i;l++){var h=s+l*o,u=l%2===0?n:a;t.lineTo(u*Math.cos(h),u*Math.sin(h))}t.closePath()}},e.prototype.drawHitDetectionCanvas_=function(t,i){i.translate(t.size/2,t.size/2),this.createPath_(i),i.fillStyle=ft,i.fill(),this.stroke_&&(i.strokeStyle=t.strokeStyle,i.lineWidth=t.strokeWidth,t.lineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit,i.stroke())},e}(Cn),$a=Ua,Ha=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Va=function(r){Ha(e,r);function e(t){var i=this,n=t||{};return i=r.call(this,{points:1/0,fill:n.fill,radius:n.radius,stroke:n.stroke,scale:n.scale!==void 0?n.scale:1,rotation:n.rotation!==void 0?n.rotation:0,rotateWithView:n.rotateWithView!==void 0?n.rotateWithView:!1,displacement:n.displacement!==void 0?n.displacement:[0,0]})||this,i}return e.prototype.clone=function(){var t=this.getScale(),i=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return i.setOpacity(this.getOpacity()),i},e.prototype.setRadius=function(t){this.radius_=t,this.render()},e}($a),On=Va,ja=function(){function r(e){var t=e||{};this.color_=t.color!==void 0?t.color:null}return r.prototype.clone=function(){var e=this.getColor();return new r({color:Array.isArray(e)?e.slice():e||void 0})},r.prototype.getColor=function(){return this.color_},r.prototype.setColor=function(e){this.color_=e},r}(),Rn=ja,za=function(){function r(e){var t=e||{};this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return r.prototype.clone=function(){var e=this.getColor();return new r({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},r.prototype.getColor=function(){return this.color_},r.prototype.getLineCap=function(){return this.lineCap_},r.prototype.getLineDash=function(){return this.lineDash_},r.prototype.getLineDashOffset=function(){return this.lineDashOffset_},r.prototype.getLineJoin=function(){return this.lineJoin_},r.prototype.getMiterLimit=function(){return this.miterLimit_},r.prototype.getWidth=function(){return this.width_},r.prototype.setColor=function(e){this.color_=e},r.prototype.setLineCap=function(e){this.lineCap_=e},r.prototype.setLineDash=function(e){this.lineDash_=e},r.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e},r.prototype.setLineJoin=function(e){this.lineJoin_=e},r.prototype.setMiterLimit=function(e){this.miterLimit_=e},r.prototype.setWidth=function(e){this.width_=e},r}(),Ja=za,wn=function(){function r(e){var t=e||{};this.geometry_=null,this.geometryFunction_=Hi,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}return r.prototype.clone=function(){var e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new r({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},r.prototype.getRenderer=function(){return this.renderer_},r.prototype.setRenderer=function(e){this.renderer_=e},r.prototype.setHitDetectionRenderer=function(e){this.hitDetectionRenderer_=e},r.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},r.prototype.getGeometry=function(){return this.geometry_},r.prototype.getGeometryFunction=function(){return this.geometryFunction_},r.prototype.getFill=function(){return this.fill_},r.prototype.setFill=function(e){this.fill_=e},r.prototype.getImage=function(){return this.image_},r.prototype.setImage=function(e){this.image_=e},r.prototype.getStroke=function(){return this.stroke_},r.prototype.setStroke=function(e){this.stroke_=e},r.prototype.getText=function(){return this.text_},r.prototype.setText=function(e){this.text_=e},r.prototype.getZIndex=function(){return this.zIndex_},r.prototype.setGeometry=function(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Hi,this.geometry_=e},r.prototype.setZIndex=function(e){this.zIndex_=e},r}();function qa(r){var e;if(typeof r=="function")e=r;else{var t;if(Array.isArray(r))t=r;else{mt(typeof r.getZIndex=="function",41);var i=r;t=[i]}e=function(){return t}}return e}var ii=null;function Ka(r,e){if(!ii){var t=new Rn({color:"rgba(255,255,255,0.4)"}),i=new Ja({color:"#3399CC",width:1.25});ii=[new wn({image:new On({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return ii}function Hi(r){return r.getGeometry()}var Ln=wn,Za=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Vi={RENDER_ORDER:"renderOrder"},Qa=function(r){Za(e,r);function e(t){var i=this,n=t||{},a=Tr({},n);return delete a.style,delete a.renderBuffer,delete a.updateWhileAnimating,delete a.updateWhileInteracting,i=r.call(this,a)||this,i.declutter_=n.declutter!==void 0?n.declutter:!1,i.renderBuffer_=n.renderBuffer!==void 0?n.renderBuffer:100,i.style_=null,i.styleFunction_=void 0,i.setStyle(n.style),i.updateWhileAnimating_=n.updateWhileAnimating!==void 0?n.updateWhileAnimating:!1,i.updateWhileInteracting_=n.updateWhileInteracting!==void 0?n.updateWhileInteracting:!1,i}return e.prototype.getDeclutter=function(){return this.declutter_},e.prototype.getFeatures=function(t){return r.prototype.getFeatures.call(this,t)},e.prototype.getRenderBuffer=function(){return this.renderBuffer_},e.prototype.getRenderOrder=function(){return this.get(Vi.RENDER_ORDER)},e.prototype.getStyle=function(){return this.style_},e.prototype.getStyleFunction=function(){return this.styleFunction_},e.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},e.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},e.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new Tn(9)),this.getRenderer().renderDeclutter(t)},e.prototype.setRenderOrder=function(t){this.set(Vi.RENDER_ORDER,t)},e.prototype.setStyle=function(t){this.style_=t!==void 0?t:Ka,this.styleFunction_=t===null?void 0:qa(this.style_),this.changed()},e}(Cr),ts=Qa,ae={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},xe=[ae.FILL],yt=[ae.STROKE],Tt=[ae.BEGIN_PATH],ji=[ae.CLOSE_PATH],I=ae,es=function(){function r(){}return r.prototype.drawCustom=function(e,t,i,n){},r.prototype.drawGeometry=function(e){},r.prototype.setStyle=function(e){},r.prototype.drawCircle=function(e,t){},r.prototype.drawFeature=function(e,t){},r.prototype.drawGeometryCollection=function(e,t){},r.prototype.drawLineString=function(e,t){},r.prototype.drawMultiLineString=function(e,t){},r.prototype.drawMultiPoint=function(e,t){},r.prototype.drawMultiPolygon=function(e,t){},r.prototype.drawPoint=function(e,t){},r.prototype.drawPolygon=function(e,t){},r.prototype.drawText=function(e,t){},r.prototype.setFillStrokeStyle=function(e,t){},r.prototype.setImageStyle=function(e,t){},r.prototype.setTextStyle=function(e,t){},r}(),Dn=es,is=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ns=function(r){is(e,r);function e(t,i,n,a){var s=r.call(this)||this;return s.tolerance=t,s.maxExtent=i,s.pixelRatio=a,s.maxLineWidth=0,s.resolution=n,s.beginGeometryInstruction1_=null,s.beginGeometryInstruction2_=null,s.bufferedMaxExtent_=null,s.instructions=[],s.coordinates=[],s.tmpCoordinate_=[],s.hitDetectionInstructions=[],s.state={},s}return e.prototype.applyPixelRatio=function(t){var i=this.pixelRatio;return i==1?t:t.map(function(n){return n*i})},e.prototype.appendFlatPointCoordinates=function(t,i){for(var n=this.getBufferedMaxExtent(),a=this.tmpCoordinate_,s=this.coordinates,o=s.length,l=0,h=t.length;l<h;l+=i)a[0]=t[l],a[1]=t[l+1],Or(n,a)&&(s[o++]=a[0],s[o++]=a[1]);return o},e.prototype.appendFlatLineCoordinates=function(t,i,n,a,s,o){var l=this.coordinates,h=l.length,u=this.getBufferedMaxExtent();o&&(i+=a);var f=t[i],c=t[i+1],d=this.tmpCoordinate_,p=!0,_,v,g;for(_=i+a;_<n;_+=a)d[0]=t[_],d[1]=t[_+1],g=Rr(u,d),g!==v?(p&&(l[h++]=f,l[h++]=c,p=!1),l[h++]=d[0],l[h++]=d[1]):g===wr.INTERSECTING?(l[h++]=d[0],l[h++]=d[1],p=!1):p=!0,f=d[0],c=d[1],v=g;return(s&&p||_===i+a)&&(l[h++]=f,l[h++]=c),h},e.prototype.drawCustomCoordinates_=function(t,i,n,a,s){for(var o=0,l=n.length;o<l;++o){var h=n[o],u=this.appendFlatLineCoordinates(t,i,h,a,!1,!1);s.push(u),i=h}return i},e.prototype.drawCustom=function(t,i,n,a){this.beginGeometry(t,i);var s=t.getType(),o=t.getStride(),l=this.coordinates.length,h,u,f,c,d;switch(s){case w.MULTI_POLYGON:h=t.getOrientedFlatCoordinates(),c=[];var p=t.getEndss();d=0;for(var _=0,v=p.length;_<v;++_){var g=[];d=this.drawCustomCoordinates_(h,d,p[_],o,g),c.push(g)}this.instructions.push([I.CUSTOM,l,c,t,n,Bi]),this.hitDetectionInstructions.push([I.CUSTOM,l,c,t,a||n,Bi]);break;case w.POLYGON:case w.MULTI_LINE_STRING:f=[],h=s==w.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(h,0,t.getEnds(),o,f),this.instructions.push([I.CUSTOM,l,f,t,n,bi]),this.hitDetectionInstructions.push([I.CUSTOM,l,f,t,a||n,bi]);break;case w.LINE_STRING:case w.CIRCLE:h=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,o,!1,!1),this.instructions.push([I.CUSTOM,l,u,t,n,zt]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,a||n,zt]);break;case w.MULTI_POINT:h=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,o),u>l&&(this.instructions.push([I.CUSTOM,l,u,t,n,zt]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,a||n,zt]));break;case w.POINT:h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([I.CUSTOM,l,u,t,n]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,a||n]);break}this.endGeometry(i)},e.prototype.beginGeometry=function(t,i){this.beginGeometryInstruction1_=[I.BEGIN_GEOMETRY,i,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[I.BEGIN_GEOMETRY,i,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var i,n=t.length,a,s,o=-1;for(i=0;i<n;++i)a=t[i],s=a[0],s==I.END_GEOMETRY?o=i:s==I.BEGIN_GEOMETRY&&(a[2]=i,Lr(this.hitDetectionInstructions,o,i),o=-1)},e.prototype.setFillStrokeStyle=function(t,i){var n=this.state;if(t){var a=t.getColor();n.fillStyle=rt(a||ft)}else n.fillStyle=void 0;if(i){var s=i.getColor();n.strokeStyle=rt(s||Qt);var o=i.getLineCap();n.lineCap=o!==void 0?o:we;var l=i.getLineDash();n.lineDash=l?l.slice():ie;var h=i.getLineDashOffset();n.lineDashOffset=h||ne;var u=i.getLineJoin();n.lineJoin=u!==void 0?u:Mt;var f=i.getWidth();n.lineWidth=f!==void 0?f:te;var c=i.getMiterLimit();n.miterLimit=c!==void 0?c:ee,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},e.prototype.createFill=function(t){var i=t.fillStyle,n=[I.SET_FILL_STYLE,i];return typeof i!="string"&&n.push(!0),n},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[I.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,i){var n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(i.call(this,t)),t.currentFillStyle=n)},e.prototype.updateStrokeStyle=function(t,i){var n=t.strokeStyle,a=t.lineCap,s=t.lineDash,o=t.lineDashOffset,l=t.lineJoin,h=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=a||s!=t.currentLineDash&&!Ne(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=l||t.currentLineWidth!=h||t.currentMiterLimit!=u)&&(n!==void 0&&i.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=a,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=l,t.currentLineWidth=h,t.currentMiterLimit=u)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var i=[I.END_GEOMETRY,t];this.instructions.push(i),this.hitDetectionInstructions.push(i)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Dr(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;pi(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(Dn),se=ns,rs=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),as=function(r){rs(e,r);function e(t,i,n,a){var s=r.call(this,t,i,n,a)||this;return s.hitDetectionImage_=null,s.image_=null,s.imagePixelRatio_=void 0,s.anchorX_=void 0,s.anchorY_=void 0,s.height_=void 0,s.opacity_=void 0,s.originX_=void 0,s.originY_=void 0,s.rotateWithView_=void 0,s.rotation_=void 0,s.scale_=void 0,s.width_=void 0,s.declutterImageWithText_=void 0,s}return e.prototype.drawPoint=function(t,i){if(!!this.image_){this.beginGeometry(t,i);var n=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,a);this.instructions.push([I.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(i)}},e.prototype.drawMultiPoint=function(t,i){if(!!this.image_){this.beginGeometry(t,i);var n=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,a);this.instructions.push([I.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(i)}},e.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,r.prototype.finish.call(this)},e.prototype.setImageStyle=function(t,i){var n=t.getAnchor(),a=t.getSize(),s=t.getHitDetectionImage(),o=t.getImage(this.pixelRatio),l=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=s,this.image_=o,this.height_=a[1],this.opacity_=t.getOpacity(),this.originX_=l[0]*this.imagePixelRatio_,this.originY_=l[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=a[0],this.declutterImageWithText_=i},e}(se),ss=as,os=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),ls=function(r){os(e,r);function e(t,i,n,a){return r.call(this,t,i,n,a)||this}return e.prototype.drawFlatCoordinates_=function(t,i,n,a){var s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,i,n,a,!1,!1),l=[I.MOVE_TO_LINE_TO,s,o];return this.instructions.push(l),this.hitDetectionInstructions.push(l),n},e.prototype.drawLineString=function(t,i){var n=this.state,a=n.strokeStyle,s=n.lineWidth;if(!(a===void 0||s===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,ie,ne],Tt);var o=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(o,0,o.length,l),this.hitDetectionInstructions.push(yt),this.endGeometry(i)}},e.prototype.drawMultiLineString=function(t,i){var n=this.state,a=n.strokeStyle,s=n.lineWidth;if(!(a===void 0||s===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,i),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],Tt);for(var o=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride(),u=0,f=0,c=o.length;f<c;++f)u=this.drawFlatCoordinates_(l,u,o[f],h);this.hitDetectionInstructions.push(yt),this.endGeometry(i)}},e.prototype.finish=function(){var t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(yt),this.reverseHitDetectionInstructions(),this.state=null,r.prototype.finish.call(this)},e.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(yt),t.lastStroke=this.coordinates.length),t.lastStroke=0,r.prototype.applyStroke.call(this,t),this.instructions.push(Tt)},e}(se),hs=ls,us=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),fs=function(r){us(e,r);function e(t,i,n,a){return r.call(this,t,i,n,a)||this}return e.prototype.drawFlatCoordinatess_=function(t,i,n,a){var s=this.state,o=s.fillStyle!==void 0,l=s.strokeStyle!==void 0,h=n.length;this.instructions.push(Tt),this.hitDetectionInstructions.push(Tt);for(var u=0;u<h;++u){var f=n[u],c=this.coordinates.length,d=this.appendFlatLineCoordinates(t,i,f,a,!0,!l),p=[I.MOVE_TO_LINE_TO,c,d];this.instructions.push(p),this.hitDetectionInstructions.push(p),l&&(this.instructions.push(ji),this.hitDetectionInstructions.push(ji)),i=f}return o&&(this.instructions.push(xe),this.hitDetectionInstructions.push(xe)),l&&(this.instructions.push(yt),this.hitDetectionInstructions.push(yt)),i},e.prototype.drawCircle=function(t,i){var n=this.state,a=n.fillStyle,s=n.strokeStyle;if(!(a===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,ft]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var o=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,l,!1,!1);var u=[I.CIRCLE,h];this.instructions.push(Tt,u),this.hitDetectionInstructions.push(Tt,u),n.fillStyle!==void 0&&(this.instructions.push(xe),this.hitDetectionInstructions.push(xe)),n.strokeStyle!==void 0&&(this.instructions.push(yt),this.hitDetectionInstructions.push(yt)),this.endGeometry(i)}},e.prototype.drawPolygon=function(t,i){var n=this.state,a=n.fillStyle,s=n.strokeStyle;if(!(a===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,ft]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var o=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,o,h),this.endGeometry(i)}},e.prototype.drawMultiPolygon=function(t,i){var n=this.state,a=n.fillStyle,s=n.strokeStyle;if(!(a===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,ft]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);for(var o=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride(),u=0,f=0,c=o.length;f<c;++f)u=this.drawFlatCoordinatess_(l,u,o[f],h);this.endGeometry(i)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var i=this.coordinates,n=0,a=i.length;n<a;++n)i[n]=Fr(i[n],t);return r.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state,i=t.fillStyle;i!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)},e}(se),zi=fs,cs={POINT:"point",LINE:"line"};function ds(r,e,t,i,n){var a=t,s=t,o=0,l=0,h=t,u,f,c,d,p,_,v,g,y,x;for(f=t;f<i;f+=n){var E=e[f],S=e[f+1];p!==void 0&&(y=E-p,x=S-_,d=Math.sqrt(y*y+x*x),v!==void 0&&(l+=c,u=Math.acos((v*y+g*x)/(c*d)),u>r&&(l>o&&(o=l,a=h,s=f),l=0,h=f-n)),c=d,v=y,g=x),p=E,_=S}return l+=d,l>o?[h,f]:[a,s]}var ps=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Me={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},_s=function(r){ps(e,r);function e(t,i,n,a){var s=r.call(this,t,i,n,a)||this;return s.labels_=null,s.text_="",s.textOffsetX_=0,s.textOffsetY_=0,s.textRotateWithView_=void 0,s.textRotation_=0,s.textFillState_=null,s.fillStates={},s.textStrokeState_=null,s.strokeStates={},s.textState_={},s.textStates={},s.textKey_="",s.fillKey_="",s.strokeKey_="",s.declutterImageWithText_=void 0,s}return e.prototype.finish=function(){var t=r.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},e.prototype.drawText=function(t,i){var n=this.textFillState_,a=this.textStrokeState_,s=this.textState_;if(!(this.text_===""||!s||!n&&!a)){var o=this.coordinates,l=o.length,h=t.getType(),u=null,f=t.getStride();if(s.placement===cs.LINE&&(h==w.LINE_STRING||h==w.MULTI_LINE_STRING||h==w.POLYGON||h==w.MULTI_POLYGON)){if(!it(this.getBufferedMaxExtent(),t.getExtent()))return;var c=void 0;if(u=t.getFlatCoordinates(),h==w.LINE_STRING)c=[u.length];else if(h==w.MULTI_LINE_STRING)c=t.getEnds();else if(h==w.POLYGON)c=t.getEnds().slice(0,1);else if(h==w.MULTI_POLYGON){var d=t.getEndss();c=[];for(var p=0,_=d.length;p<_;++p)c.push(d[p][0])}this.beginGeometry(t,i);for(var v=s.textAlign,g=0,y=void 0,x=0,E=c.length;x<E;++x){if(v==null){var S=ds(s.maxAngle,u,g,c[x],f);g=S[0],y=S[1]}else y=c[x];for(var p=g;p<y;p+=f)o.push(u[p],u[p+1]);var C=o.length;g=c[x],this.drawChars_(l,C),l=C}this.endGeometry(i)}else{var R=s.overflow?null:[];switch(h){case w.POINT:case w.MULTI_POINT:u=t.getFlatCoordinates();break;case w.LINE_STRING:u=t.getFlatMidpoint();break;case w.CIRCLE:u=t.getCenter();break;case w.MULTI_LINE_STRING:u=t.getFlatMidpoints(),f=2;break;case w.POLYGON:u=t.getFlatInteriorPoint(),s.overflow||R.push(u[2]/this.resolution),f=3;break;case w.MULTI_POLYGON:var T=t.getFlatInteriorPoints();u=[];for(var p=0,_=T.length;p<_;p+=3)s.overflow||R.push(T[p+2]/this.resolution),u.push(T[p],T[p+1]);if(u.length===0)return;f=2;break}var C=this.appendFlatPointCoordinates(u,f);if(C===l)return;if(R&&(C-l)/2!==u.length/f){var O=l/2;R=R.filter(function(B,M){var b=o[(O+M)*2]===u[M*f]&&o[(O+M)*2+1]===u[M*f+1];return b||--O,b})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,i);var F=s.padding;if(F!=It&&(s.scale[0]<0||s.scale[1]<0)){var L=s.padding[0],D=s.padding[1],P=s.padding[2],k=s.padding[3];s.scale[0]<0&&(D=-D,k=-k),s.scale[1]<0&&(L=-L,P=-P),F=[L,D,P,k]}var H=this.pixelRatio;this.instructions.push([I.DRAW_IMAGE,l,C,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,F==It?It:F.map(function(B){return B*H}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,R]);var G=1/H;this.hitDetectionInstructions.push([I.DRAW_IMAGE,l,C,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[G,G],NaN,this.declutterImageWithText_,F,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,R]),this.endGeometry(i)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,i=this.textState_,n=this.textFillState_,a=this.strokeKey_;t&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var s=this.textKey_;s in this.textStates||(this.textStates[s]={font:i.font,textAlign:i.textAlign||re,textBaseline:i.textBaseline||Le,scale:i.scale});var o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))},e.prototype.drawChars_=function(t,i){var n=this.textStrokeState_,a=this.textState_,s=this.strokeKey_,o=this.textKey_,l=this.fillKey_;this.saveTextStates_();var h=this.pixelRatio,u=Me[a.textBaseline],f=this.textOffsetY_*h,c=this.text_,d=n?n.lineWidth*Math.abs(a.scale[0])/2:0;this.instructions.push([I.DRAW_CHARS,t,i,u,a.overflow,l,a.maxAngle,h,f,s,d*h,c,o,1]),this.hitDetectionInstructions.push([I.DRAW_CHARS,t,i,u,a.overflow,l,a.maxAngle,1,f,s,d,c,o,1/h])},e.prototype.setTextStyle=function(t,i){var n,a,s;if(!t)this.text_="";else{var o=t.getFill();o?(a=this.textFillState_,a||(a={},this.textFillState_=a),a.fillStyle=rt(o.getColor()||ft)):(a=null,this.textFillState_=a);var l=t.getStroke();if(!l)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);var h=l.getLineDash(),u=l.getLineDashOffset(),f=l.getWidth(),c=l.getMiterLimit();s.lineCap=l.getLineCap()||we,s.lineDash=h?h.slice():ie,s.lineDashOffset=u===void 0?ne:u,s.lineJoin=l.getLineJoin()||Mt,s.lineWidth=f===void 0?te:f,s.miterLimit=c===void 0?ee:c,s.strokeStyle=rt(l.getColor()||Qt)}n=this.textState_;var d=t.getFont()||gn;Pr(d);var p=t.getScaleArray();n.overflow=t.getOverflow(),n.font=d,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||Le,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||It,n.scale=p===void 0?[1,1]:p;var _=t.getOffsetX(),v=t.getOffsetY(),g=t.getRotateWithView(),y=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=_===void 0?0:_,this.textOffsetY_=v===void 0?0:v,this.textRotateWithView_=g===void 0?!1:g,this.textRotation_=y===void 0?0:y,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:X(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.textBaseline||"?"),this.fillKey_=a?typeof a.fillStyle=="string"?a.fillStyle:"|"+X(a.fillStyle):""}this.declutterImageWithText_=i},e}(se),vs=_s,gs={Circle:zi,Default:se,Image:ss,LineString:hs,Polygon:zi,Text:vs},ys=function(){function r(e,t,i,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}return r.prototype.finish=function(){var e={};for(var t in this.buildersByZIndex_){e[t]=e[t]||{};var i=this.buildersByZIndex_[t];for(var n in i){var a=i[n].finish();e[t][n]=a}}return e},r.prototype.getBuilder=function(e,t){var i=e!==void 0?e.toString():"0",n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);var a=n[t];if(a===void 0){var s=gs[t];a=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=a}return a},r}(),Ji=ys,N={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function ms(r,e,t,i,n,a,s,o,l,h,u,f){var c=r[e],d=r[e+1],p=0,_=0,v=0,g=0;function y(){p=c,_=d,e+=i,c=r[e],d=r[e+1],g+=v,v=Math.sqrt((c-p)*(c-p)+(d-_)*(d-_))}do y();while(e<t-i&&g+v<a);for(var x=v===0?0:(a-g)/v,E=vt(p,c,x),S=vt(_,d,x),C=e-i,R=g,T=a+o*l(h,n,u);e<t-i&&g+v<T;)y();x=v===0?0:(T-g)/v;var O=vt(p,c,x),F=vt(_,d,x),L;if(f){var D=[E,S,O,F];Ar(D,0,4,2,f,D,D),L=D[0]>D[2]}else L=E>O;var P=Math.PI,k=[],H=C+i===e;e=C,v=0,g=R,c=r[e],d=r[e+1];var G;if(H){y(),G=Math.atan2(d-_,c-p),L&&(G+=G>0?-P:P);var A=(O+E)/2,B=(F+S)/2;return k[0]=[A,B,(T-a)/2,G,n],k}for(var M=0,b=n.length;M<b;){y();var Y=Math.atan2(d-_,c-p);if(L&&(Y+=Y>0?-P:P),G!==void 0){var m=Y-G;if(m+=m>P?-2*P:m<-P?2*P:0,Math.abs(m)>s)return null}G=Y;for(var st=M,ot=0;M<b;++M){var bt=L?b-M-1:M,le=o*l(h,n[bt],u);if(e+i<t&&g+v<a+ot+le/2)break;ot+=le}if(M!==st){var Xe=L?n.substring(b-st,b-M):n.substring(st,M);x=v===0?0:(a+ot/2-g)/v;var A=vt(p,c,x),B=vt(_,d,x);k.push([A,B,ot/2,Y,Xe]),a+=ot}}return k}var wt=Pe(),dt=[],ht=[],ut=[],pt=[];function qi(r){return r[3].declutterBox}var xs=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Ki(r,e){return(e==="start"||e==="end")&&!xs.test(r)&&(e=e==="start"?"left":"right"),Me[e]}var Es=function(){function r(e,t,i,n){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=De(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return r.prototype.createLabel=function(e,t,i,n){var a=e+t+i+n;if(this.labels_[a])return this.labels_[a];var s=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,l=this.textStates[t],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],f=Ki(e,l.textAlign||re),c=n&&s.lineWidth?s.lineWidth:0,d=e.split(`
`),p=d.length,_=[],v=Mr(l.font,d,_),g=Nr(l.font),y=g*p,x=v+c,E=[],S=(x+2)*u[0],C=(y+c)*u[1],R={width:S<0?Math.floor(S):Math.ceil(S),height:C<0?Math.floor(C):Math.ceil(C),contextInstructions:E};if((u[0]!=1||u[1]!=1)&&E.push("scale",u),E.push("font",l.font),n){E.push("strokeStyle",s.strokeStyle),E.push("lineWidth",c),E.push("lineCap",s.lineCap),E.push("lineJoin",s.lineJoin),E.push("miterLimit",s.miterLimit);var T=kr?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;T.prototype.setLineDash&&(E.push("setLineDash",[s.lineDash]),E.push("lineDashOffset",s.lineDashOffset))}i&&E.push("fillStyle",o.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");var O=.5-f,F=f*x+O*c,L;if(n)for(L=0;L<p;++L)E.push("strokeText",[d[L],F+O*_[L],.5*(c+g)+L*g]);if(i)for(L=0;L<p;++L)E.push("fillText",[d[L],F+O*_[L],.5*(c+g)+L*g]);return this.labels_[a]=R,R},r.prototype.replayTextBackground_=function(e,t,i,n,a,s,o){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,n),e.lineTo.apply(e,a),e.lineTo.apply(e,t),s&&(this.alignFill_=s[2],this.fill_(e)),o&&(this.setStrokeStyle_(e,o),e.stroke())},r.prototype.calculateImageOrLabelDimensions_=function(e,t,i,n,a,s,o,l,h,u,f,c,d,p,_,v){o*=c[0],l*=c[1];var g=i-o,y=n-l,x=a+h>e?e-h:a,E=s+u>t?t-u:s,S=p[3]+x*c[0]+p[1],C=p[0]+E*c[1]+p[2],R=g-p[3],T=y-p[0];(_||f!==0)&&(dt[0]=R,pt[0]=R,dt[1]=T,ht[1]=T,ht[0]=R+S,ut[0]=ht[0],ut[1]=T+C,pt[1]=ut[1]);var O;return f!==0?(O=Fe(De(),i,n,1,1,f,-i,-n),Ft(O,dt),Ft(O,ht),Ft(O,ut),Ft(O,pt),hi(Math.min(dt[0],ht[0],ut[0],pt[0]),Math.min(dt[1],ht[1],ut[1],pt[1]),Math.max(dt[0],ht[0],ut[0],pt[0]),Math.max(dt[1],ht[1],ut[1],pt[1]),wt)):hi(Math.min(R,R+S),Math.min(T,T+C),Math.max(R,R+S),Math.max(T,T+C),wt),d&&(g=Math.round(g),y=Math.round(y)),{drawImageX:g,drawImageY:y,drawImageW:x,drawImageH:E,originX:h,originY:u,declutterBox:{minX:wt[0],minY:wt[1],maxX:wt[2],maxY:wt[3],value:v},canvasTransform:O,scale:c}},r.prototype.replayImageOrLabel_=function(e,t,i,n,a,s,o){var l=!!(s||o),h=n.declutterBox,u=e.canvas,f=o?o[2]*n.scale[0]/2:0,c=h.minX-f<=u.width/t&&h.maxX+f>=0&&h.minY-f<=u.height/t&&h.maxY+f>=0;return c&&(l&&this.replayTextBackground_(e,dt,ht,ut,pt,s,o),br(e,n.canvasTransform,a,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},r.prototype.fill_=function(e){if(this.alignFill_){var t=Ft(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;e.save(),e.translate(t[0]%i,t[1]%i),e.rotate(this.viewRotation_)}e.fill(),this.alignFill_&&e.restore()},r.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.setLineDash&&(e.lineDashOffset=t[7],e.setLineDash(t[6]))},r.prototype.drawLabelWithPointPlacement_=function(e,t,i,n){var a=this.textStates[t],s=this.createLabel(e,t,n,i),o=this.strokeStates[i],l=this.pixelRatio,h=Ki(e,a.textAlign||re),u=Me[a.textBaseline||Le],f=o&&o.lineWidth?o.lineWidth:0,c=s.width/l-2*a.scale[0],d=h*c+2*(.5-h)*f,p=u*s.height/l+2*(.5-u)*f;return{label:s,anchorX:d,anchorY:p}},r.prototype.execute_=function(e,t,i,n,a,s,o,l){var h;this.pixelCoordinates_&&Ne(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Kt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Br(this.renderedTransform_,i));for(var u=0,f=n.length,c=0,d,p,_,v,g,y,x,E,S,C,R,T,O=0,F=0,L=null,D=null,P=this.coordinateCache_,k=this.viewRotation_,H=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,G={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},A=this.instructions!=n||this.overlaps?0:200,B,M,b,Y;u<f;){var m=n[u],st=m[0];switch(st){case I.BEGIN_GEOMETRY:B=m[1],Y=m[3],B.getGeometry()?o!==void 0&&!it(o,Y.getExtent())?u=m[2]+1:++u:u=m[2];break;case I.BEGIN_PATH:O>A&&(this.fill_(e),O=0),F>A&&(e.stroke(),F=0),!O&&!F&&(e.beginPath(),v=NaN,g=NaN),++u;break;case I.CIRCLE:c=m[1];var ot=h[c],bt=h[c+1],le=h[c+2],Xe=h[c+3],Si=le-ot,Ii=Xe-bt,Ti=Math.sqrt(Si*Si+Ii*Ii);e.moveTo(ot+Ti,bt),e.arc(ot,bt,Ti,0,2*Math.PI,!0),++u;break;case I.CLOSE_PATH:e.closePath(),++u;break;case I.CUSTOM:c=m[1],d=m[2];var zn=m[3],Jn=m[4],Ci=m.length==6?m[5]:void 0;G.geometry=zn,G.feature=B,u in P||(P[u]=[]);var Bt=P[u];Ci?Ci(h,c,d,2,Bt):(Bt[0]=h[c],Bt[1]=h[c+1],Bt.length=2),Jn(Bt,G),++u;break;case I.DRAW_IMAGE:c=m[1],d=m[2],E=m[3],p=m[4],_=m[5];var Ue=m[6],qn=m[7],Kn=m[8],Zn=m[9],Oi=m[10],$e=m[11],Qn=m[12],he=m[13],Gt=m[14];if(!E&&m.length>=19){S=m[18],C=m[19],R=m[20],T=m[21];var He=this.drawLabelWithPointPlacement_(S,C,R,T);E=He.label,m[3]=E;var tr=m[22];p=(He.anchorX-tr)*this.pixelRatio,m[4]=p;var er=m[23];_=(He.anchorY-er)*this.pixelRatio,m[5]=_,Ue=E.height,m[6]=Ue,he=E.width,m[13]=he}var Ve=void 0;m.length>24&&(Ve=m[24]);var je=void 0,ue=void 0,fe=void 0;m.length>16?(je=m[15],ue=m[16],fe=m[17]):(je=It,ue=!1,fe=!1),Oi&&H?$e+=k:!Oi&&!H&&($e-=k);for(var ir=0;c<d;c+=2)if(!(Ve&&Ve[ir++]<he/this.pixelRatio)){var lt=this.calculateImageOrLabelDimensions_(E.width,E.height,h[c],h[c+1],he,Ue,p,_,Kn,Zn,$e,Qn,a,je,ue||fe,B),Ri=[e,t,E,lt,qn,ue?L:null,fe?D:null],ce=void 0,ze=void 0;if(l&&Gt){var de=d-c;if(!Gt[de]){Gt[de]=Ri;continue}if(ce=Gt[de],delete Gt[de],ze=qi(ce),l.collides(ze))continue}l&&l.collides(lt.declutterBox)||(ce&&(l&&l.insert(ze),this.replayImageOrLabel_.apply(this,ce)),l&&l.insert(lt.declutterBox),this.replayImageOrLabel_.apply(this,Ri))}++u;break;case I.DRAW_CHARS:var wi=m[1],Li=m[2],Je=m[3],nr=m[4];T=m[5];var rr=m[6],Di=m[7],Fi=m[8];R=m[9];var qe=m[10];S=m[11],C=m[12];var Pi=[m[13],m[13]],Ke=this.textStates[C],Yt=Ke.font,Wt=[Ke.scale[0]*Di,Ke.scale[1]*Di],Xt=void 0;Yt in this.widths_?Xt=this.widths_[Yt]:(Xt={},this.widths_[Yt]=Xt);var Ai=Sn(h,wi,Li,2),Mi=Math.abs(Wt[0])*Gi(Yt,S,Xt);if(nr||Mi<=Ai){var ar=this.textStates[C].textAlign,sr=(Ai-Mi)*Me[ar],Ut=ms(h,wi,Li,2,S,sr,rr,Math.abs(Wt[0]),Gi,Yt,Xt,H?0:this.viewRotation_);t:if(Ut){var $t=[],ct=void 0,pe=void 0,_e=void 0,V=void 0,Z=void 0;if(R)for(ct=0,pe=Ut.length;ct<pe;++ct){Z=Ut[ct],_e=Z[4],V=this.createLabel(_e,C,"",R),p=Z[2]+(Wt[0]<0?-qe:qe),_=Je*V.height+(.5-Je)*2*qe*Wt[1]/Wt[0]-Fi;var lt=this.calculateImageOrLabelDimensions_(V.width,V.height,Z[0],Z[1],V.width,V.height,p,_,0,0,Z[3],Pi,!1,It,!1,B);if(l&&l.collides(lt.declutterBox))break t;$t.push([e,t,V,lt,1,null,null])}if(T)for(ct=0,pe=Ut.length;ct<pe;++ct){Z=Ut[ct],_e=Z[4],V=this.createLabel(_e,C,T,""),p=Z[2],_=Je*V.height-Fi;var lt=this.calculateImageOrLabelDimensions_(V.width,V.height,Z[0],Z[1],V.width,V.height,p,_,0,0,Z[3],Pi,!1,It,!1,B);if(l&&l.collides(lt.declutterBox))break t;$t.push([e,t,V,lt,1,null,null])}l&&l.load($t.map(qi));for(var Ze=0,or=$t.length;Ze<or;++Ze)this.replayImageOrLabel_.apply(this,$t[Ze])}}++u;break;case I.END_GEOMETRY:if(s!==void 0){B=m[1];var Ni=s(B,Y);if(Ni)return Ni}++u;break;case I.FILL:A?O++:this.fill_(e),++u;break;case I.MOVE_TO_LINE_TO:for(c=m[1],d=m[2],M=h[c],b=h[c+1],y=M+.5|0,x=b+.5|0,(y!==v||x!==g)&&(e.moveTo(M,b),v=y,g=x),c+=2;c<d;c+=2)M=h[c],b=h[c+1],y=M+.5|0,x=b+.5|0,(c==d-2||y!==v||x!==g)&&(e.lineTo(M,b),v=y,g=x);++u;break;case I.SET_FILL_STYLE:L=m,this.alignFill_=m[2],O&&(this.fill_(e),O=0,F&&(e.stroke(),F=0)),e.fillStyle=m[1],++u;break;case I.SET_STROKE_STYLE:D=m,F&&(e.stroke(),F=0),this.setStrokeStyle_(e,m),++u;break;case I.STROKE:A?F++:e.stroke(),++u;break;default:++u;break}}O&&this.fill_(e),F&&e.stroke()},r.prototype.execute=function(e,t,i,n,a,s){this.viewRotation_=n,this.execute_(e,t,i,this.instructions,a,void 0,void 0,s)},r.prototype.executeHitDetection=function(e,t,i,n,a){return this.viewRotation_=i,this.execute_(e,1,t,this.hitDetectionInstructions,!0,n,a)},r}(),Ss=Es,ni=[N.POLYGON,N.CIRCLE,N.LINE_STRING,N.IMAGE,N.TEXT,N.DEFAULT],Is=function(){function r(e,t,i,n,a,s){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=De(),this.createExecutors_(a)}return r.prototype.clip=function(e,t){var i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()},r.prototype.createExecutors_=function(e){for(var t in e){var i=this.executorsByZIndex_[t];i===void 0&&(i={},this.executorsByZIndex_[t]=i);var n=e[t];for(var a in n){var s=n[a];i[a]=new Ss(this.resolution_,this.pixelRatio_,this.overlaps_,s)}}},r.prototype.hasExecutors=function(e){for(var t in this.executorsByZIndex_)for(var i=this.executorsByZIndex_[t],n=0,a=e.length;n<a;++n)if(e[n]in i)return!0;return!1},r.prototype.forEachFeatureAtCoordinate=function(e,t,i,n,a,s){n=Math.round(n);var o=n*2+1,l=Fe(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-i,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Ct(o,o));var u=this.hitDetectionContext_;u.canvas.width!==o||u.canvas.height!==o?(u.canvas.width=o,u.canvas.height=o):h||u.clearRect(0,0,o,o);var f;this.renderBuffer_!==void 0&&(f=Pe(),Gr(f,e),pi(f,t*(this.renderBuffer_+n),f));var c=Ts(n),d;function p(C,R){for(var T=u.getImageData(0,0,o,o).data,O=0,F=c.length;O<F;O++)if(T[c[O]]>0){if(!s||d!==N.IMAGE&&d!==N.TEXT||s.indexOf(C)!==-1){var L=(c[O]-3)/4,D=n-L%o,P=n-(L/o|0),k=a(C,R,D*D+P*P);if(k)return k}u.clearRect(0,0,o,o);break}}var _=Object.keys(this.executorsByZIndex_).map(Number);_.sort(ui);var v,g,y,x,E;for(v=_.length-1;v>=0;--v){var S=_[v].toString();for(y=this.executorsByZIndex_[S],g=ni.length-1;g>=0;--g)if(d=ni[g],x=y[d],x!==void 0&&(E=x.executeHitDetection(u,l,i,p,f),E))return E}},r.prototype.getClipCoords=function(e){var t=this.maxExtent_;if(!t)return null;var i=t[0],n=t[1],a=t[2],s=t[3],o=[i,n,i,s,a,s,a,n];return Kt(o,0,8,2,e,o),o},r.prototype.isEmpty=function(){return Ae(this.executorsByZIndex_)},r.prototype.execute=function(e,t,i,n,a,s,o){var l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(ui),this.maxExtent_&&(e.save(),this.clip(e,i));var h=s||ni,u,f,c,d,p,_;for(o&&l.reverse(),u=0,f=l.length;u<f;++u){var v=l[u].toString();for(p=this.executorsByZIndex_[v],c=0,d=h.length;c<d;++c){var g=h[c];_=p[g],_!==void 0&&_.execute(e,t,i,n,a,o)}}this.maxExtent_&&e.restore()},r}(),ri={};function Ts(r){if(ri[r]!==void 0)return ri[r];for(var e=r*2+1,t=r*r,i=new Array(t+1),n=0;n<=r;++n)for(var a=0;a<=r;++a){var s=n*n+a*a;if(s>t)break;var o=i[s];o||(o=[],i[s]=o),o.push(((r+n)*e+(r+a))*4+3),n>0&&o.push(((r-n)*e+(r+a))*4+3),a>0&&(o.push(((r+n)*e+(r-a))*4+3),n>0&&o.push(((r-n)*e+(r-a))*4+3))}for(var l=[],n=0,h=i.length;n<h;++n)i[n]&&l.push.apply(l,i[n]);return ri[r]=l,l}var Zi=Is,Cs=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Os=function(r){Cs(e,r);function e(t,i,n,a,s,o,l){var h=r.call(this)||this;return h.context_=t,h.pixelRatio_=i,h.extent_=n,h.transform_=a,h.viewRotation_=s,h.squaredTolerance_=o,h.userTransform_=l,h.contextFillState_=null,h.contextStrokeState_=null,h.contextTextState_=null,h.fillState_=null,h.strokeState_=null,h.image_=null,h.imageAnchorX_=0,h.imageAnchorY_=0,h.imageHeight_=0,h.imageOpacity_=0,h.imageOriginX_=0,h.imageOriginY_=0,h.imageRotateWithView_=!1,h.imageRotation_=0,h.imageScale_=[0,0],h.imageWidth_=0,h.text_="",h.textOffsetX_=0,h.textOffsetY_=0,h.textRotateWithView_=!1,h.textRotation_=0,h.textScale_=[0,0],h.textFillState_=null,h.textStrokeState_=null,h.textState_=null,h.pixelCoordinates_=[],h.tmpLocalTransform_=De(),h}return e.prototype.drawImages_=function(t,i,n,a){if(!!this.image_){var s=Kt(t,i,n,a,this.transform_,this.pixelCoordinates_),o=this.context_,l=this.tmpLocalTransform_,h=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=h*this.imageOpacity_);var u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(var f=0,c=s.length;f<c;f+=2){var d=s[f]-this.imageAnchorX_,p=s[f+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var _=d+this.imageAnchorX_,v=p+this.imageAnchorY_;Fe(l,_,v,1,1,u,-_,-v),o.setTransform.apply(o,l),o.translate(_,v),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,p,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=h)}},e.prototype.drawText_=function(t,i,n,a){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var s=Kt(t,i,n,a,this.transform_,this.pixelCoordinates_),o=this.context_,l=this.textRotation_;for(this.textRotateWithView_&&(l+=this.viewRotation_);i<n;i+=a){var h=s[i]+this.textOffsetX_,u=s[i+1]+this.textOffsetY_;if(l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var f=Fe(this.tmpLocalTransform_,h,u,1,1,l,-h,-u);o.setTransform.apply(o,f),o.translate(h,u),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&o.strokeText(this.text_,h,u),this.textFillState_&&o.fillText(this.text_,h,u)}}},e.prototype.moveToLineTo_=function(t,i,n,a,s){var o=this.context_,l=Kt(t,i,n,a,this.transform_,this.pixelCoordinates_);o.moveTo(l[0],l[1]);var h=l.length;s&&(h-=2);for(var u=2;u<h;u+=2)o.lineTo(l[u],l[u+1]);return s&&o.closePath(),n},e.prototype.drawRings_=function(t,i,n,a){for(var s=0,o=n.length;s<o;++s)i=this.moveToLineTo_(t,i,n[s],a,!0);return i},e.prototype.drawCircle=function(t){if(!!it(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=Yr(t,this.transform_,this.pixelCoordinates_),n=i[2]-i[0],a=i[3]-i[1],s=Math.sqrt(n*n+a*a),o=this.context_;o.beginPath(),o.arc(i[0],i[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){var i=t.getType();switch(i){case w.POINT:this.drawPoint(t);break;case w.LINE_STRING:this.drawLineString(t);break;case w.POLYGON:this.drawPolygon(t);break;case w.MULTI_POINT:this.drawMultiPoint(t);break;case w.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case w.MULTI_POLYGON:this.drawMultiPolygon(t);break;case w.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case w.CIRCLE:this.drawCircle(t);break}},e.prototype.drawFeature=function(t,i){var n=i.getGeometryFunction()(t);!n||!it(this.extent_,n.getExtent())||(this.setStyle(i),this.drawGeometry(n))},e.prototype.drawGeometryCollection=function(t){for(var i=t.getGeometriesArray(),n=0,a=i.length;n<a;++n)this.drawGeometry(i[n])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var i=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var i=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(i,0,i.length,n),this.text_!==""&&this.drawText_(i,0,i.length,n)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!it(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,n=t.getFlatCoordinates();i.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),i.stroke()}if(this.text_!==""){var a=t.getFlatMidpoint();this.drawText_(a,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var i=t.getExtent();if(!!it(this.extent_,i)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,a=t.getFlatCoordinates(),s=0,o=t.getEnds(),l=t.getStride();n.beginPath();for(var h=0,u=o.length;h<u;++h)s=this.moveToLineTo_(a,s,o[h],l,!1);n.stroke()}if(this.text_!==""){var f=t.getFlatMidpoints();this.drawText_(f,0,f.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!it(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=this.context_;i.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){var n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!it(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var i=this.context_,n=t.getOrientedFlatCoordinates(),a=0,s=t.getEndss(),o=t.getStride();i.beginPath();for(var l=0,h=s.length;l<h;++l){var u=s[l];a=this.drawRings_(n,a,u,o)}this.fillState_&&i.fill(),this.strokeState_&&i.stroke()}if(this.text_!==""){var f=t.getFlatInteriorPoints();this.drawText_(f,0,f.length,2)}}},e.prototype.setContextFillState_=function(t){var i=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,i.fillStyle=t.fillStyle):(i.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var i=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,i.lineCap=t.lineCap),i.setLineDash&&(Ne(n.lineDash,t.lineDash)||i.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,i.lineDashOffset=t.lineDashOffset)),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,i.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,i.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,i.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,i.strokeStyle=t.strokeStyle)):(i.lineCap=t.lineCap,i.setLineDash&&(i.setLineDash(t.lineDash),i.lineDashOffset=t.lineDashOffset),i.lineJoin=t.lineJoin,i.lineWidth=t.lineWidth,i.miterLimit=t.miterLimit,i.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var i=this.context_,n=this.contextTextState_,a=t.textAlign?t.textAlign:re;n?(n.font!=t.font&&(n.font=t.font,i.font=t.font),n.textAlign!=a&&(n.textAlign=a,i.textAlign=a),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,i.textBaseline=t.textBaseline)):(i.font=t.font,i.textAlign=a,i.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:a,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,i){var n=this;if(!t)this.fillState_=null;else{var a=t.getColor();this.fillState_={fillStyle:rt(a||ft)}}if(!i)this.strokeState_=null;else{var s=i.getColor(),o=i.getLineCap(),l=i.getLineDash(),h=i.getLineDashOffset(),u=i.getLineJoin(),f=i.getWidth(),c=i.getMiterLimit(),d=l||ie;this.strokeState_={lineCap:o!==void 0?o:we,lineDash:this.pixelRatio_===1?d:d.map(function(p){return p*n.pixelRatio_}),lineDashOffset:(h||ne)*this.pixelRatio_,lineJoin:u!==void 0?u:Mt,lineWidth:(f!==void 0?f:te)*this.pixelRatio_,miterLimit:c!==void 0?c:ee,strokeStyle:rt(s||Qt)}}},e.prototype.setImageStyle=function(t){var i;if(!t||!(i=t.getSize())){this.image_=null;return}var n=t.getAnchor(),a=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*this.pixelRatio_,this.imageAnchorY_=n[1]*this.pixelRatio_,this.imageHeight_=i[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=a[0],this.imageOriginY_=a[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=i[0]*this.pixelRatio_},e.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var i=t.getFill();if(!i)this.textFillState_=null;else{var n=i.getColor();this.textFillState_={fillStyle:rt(n||ft)}}var a=t.getStroke();if(!a)this.textStrokeState_=null;else{var s=a.getColor(),o=a.getLineCap(),l=a.getLineDash(),h=a.getLineDashOffset(),u=a.getLineJoin(),f=a.getWidth(),c=a.getMiterLimit();this.textStrokeState_={lineCap:o!==void 0?o:we,lineDash:l||ie,lineDashOffset:h||ne,lineJoin:u!==void 0?u:Mt,lineWidth:f!==void 0?f:te,miterLimit:c!==void 0?c:ee,strokeStyle:rt(s||Qt)}}var d=t.getFont(),p=t.getOffsetX(),_=t.getOffsetY(),v=t.getRotateWithView(),g=t.getRotation(),y=t.getScaleArray(),x=t.getText(),E=t.getTextAlign(),S=t.getTextBaseline();this.textState_={font:d!==void 0?d:gn,textAlign:E!==void 0?E:re,textBaseline:S!==void 0?S:Le},this.text_=x!==void 0?x:"",this.textOffsetX_=p!==void 0?this.pixelRatio_*p:0,this.textOffsetY_=_!==void 0?this.pixelRatio_*_:0,this.textRotateWithView_=v!==void 0?v:!1,this.textRotation_=g!==void 0?g:0,this.textScale_=[this.pixelRatio_*y[0],this.pixelRatio_*y[1]]}},e}(Dn),Rs=Os,gt={FRACTION:"fraction",PIXELS:"pixels"},Q={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},ws=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),jt=null,Ls=function(r){ws(e,r);function e(t,i,n,a,s,o){var l=r.call(this)||this;return l.hitDetectionImage_=null,l.image_=t||new Image,a!==null&&(l.image_.crossOrigin=a),l.canvas_={},l.color_=o,l.unlisten_=null,l.imageState_=s,l.size_=n,l.src_=i,l.tainted_,l}return e.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===j.LOADED){jt||(jt=Ct(1,1)),jt.drawImage(this.image_,0,0);try{jt.getImageData(0,0,1,1),this.tainted_=!1}catch{jt=null,this.tainted_=!0}}return this.tainted_===!0},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(Zt.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=j.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=j.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],i=this.size_[1],n=Ct(t,i);n.fillRect(0,0,t,i),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==j.IDLE){this.imageState_=j.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Wr(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(!(!this.color_||this.canvas_[t]||this.imageState_!==j.LOADED)){var i=document.createElement("canvas");this.canvas_[t]=i,i.width=Math.ceil(this.image_.width*t),i.height=Math.ceil(this.image_.height*t);var n=i.getContext("2d");if(n.scale(t,t),n.drawImage(this.image_,0,0),n.globalCompositeOperation="multiply",n.globalCompositeOperation==="multiply"||this.isTainted_())n.fillStyle=Xr(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(this.image_,0,0);else{for(var a=n.getImageData(0,0,i.width,i.height),s=a.data,o=this.color_[0]/255,l=this.color_[1]/255,h=this.color_[2]/255,u=this.color_[3],f=0,c=s.length;f<c;f+=4)s[f]*=o,s[f+1]*=l,s[f+2]*=h,s[f+3]*=u;n.putImageData(a,0,0)}}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(Ur);function Ds(r,e,t,i,n,a){var s=Yi.get(e,i,a);return s||(s=new Ls(r,e,t,i,n,a),Yi.set(e,i,a,s)),s}var Fs=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ps=function(r){Fs(e,r);function e(t){var i=this,n=t||{},a=n.opacity!==void 0?n.opacity:1,s=n.rotation!==void 0?n.rotation:0,o=n.scale!==void 0?n.scale:1,l=n.rotateWithView!==void 0?n.rotateWithView:!1;i=r.call(this,{opacity:a,rotation:s,scale:o,displacement:n.displacement!==void 0?n.displacement:[0,0],rotateWithView:l})||this,i.anchor_=n.anchor!==void 0?n.anchor:[.5,.5],i.normalizedAnchor_=null,i.anchorOrigin_=n.anchorOrigin!==void 0?n.anchorOrigin:Q.TOP_LEFT,i.anchorXUnits_=n.anchorXUnits!==void 0?n.anchorXUnits:gt.FRACTION,i.anchorYUnits_=n.anchorYUnits!==void 0?n.anchorYUnits:gt.FRACTION,i.crossOrigin_=n.crossOrigin!==void 0?n.crossOrigin:null;var h=n.img!==void 0?n.img:null,u=n.imgSize!==void 0?n.imgSize:null,f=n.src;mt(!(f!==void 0&&h),4),mt(!h||h&&u,5),(f===void 0||f.length===0)&&h&&(f=h.src||X(h)),mt(f!==void 0&&f.length>0,6);var c=n.src!==void 0?j.IDLE:j.LOADED;return i.color_=n.color!==void 0?vn(n.color):null,i.iconImage_=Ds(h,f,u,i.crossOrigin_,c,i.color_),i.offset_=n.offset!==void 0?n.offset:[0,0],i.offsetOrigin_=n.offsetOrigin!==void 0?n.offsetOrigin:Q.TOP_LEFT,i.origin_=null,i.size_=n.size!==void 0?n.size:null,i}return e.prototype.clone=function(){var t=this.getScale();return new e({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:this.size_!==null?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var i=this.getSize();if(this.anchorXUnits_==gt.FRACTION||this.anchorYUnits_==gt.FRACTION){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_==gt.FRACTION&&(t[0]*=i[0]),this.anchorYUnits_==gt.FRACTION&&(t[1]*=i[1])}if(this.anchorOrigin_!=Q.TOP_LEFT){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_==Q.TOP_RIGHT||this.anchorOrigin_==Q.BOTTOM_RIGHT)&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_==Q.BOTTOM_LEFT||this.anchorOrigin_==Q.BOTTOM_RIGHT)&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}var n=this.getDisplacement();return[t[0]-n[0],t[1]+n[1]]},e.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},e.prototype.getColor=function(){return this.color_},e.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},e.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},e.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=Q.TOP_LEFT){var i=this.getSize(),n=this.iconImage_.getSize();if(!i||!n)return null;t=t.slice(),(this.offsetOrigin_==Q.TOP_RIGHT||this.offsetOrigin_==Q.BOTTOM_RIGHT)&&(t[0]=n[0]-i[0]-t[0]),(this.offsetOrigin_==Q.BOTTOM_LEFT||this.offsetOrigin_==Q.BOTTOM_RIGHT)&&(t[1]=n[1]-i[1]-t[1])}return this.origin_=t,this.origin_},e.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(Zt.CHANGE,t)},e.prototype.load=function(){this.iconImage_.load()},e.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(Zt.CHANGE,t)},e}(Cn),Fn=Ps,nt=.5;function As(r,e,t,i,n,a,s){var o=r[0]*nt,l=r[1]*nt,h=Ct(o,l);h.imageSmoothingEnabled=!1;for(var u=h.canvas,f=new Rs(h,nt,n,null,s),c=t.length,d=Math.floor((256*256*256-1)/c),p={},_=1;_<=c;++_){var v=t[_-1],g=v.getStyleFunction()||i;if(!!i){var y=g(v,a);if(!!y){Array.isArray(y)||(y=[y]);for(var x=_*d,E="#"+("000000"+x.toString(16)).slice(-6),S=0,C=y.length;S<C;++S){var R=y[S],T=R.getGeometryFunction()(v);if(!(!T||!it(n,T.getExtent()))){var O=R.clone(),F=O.getFill();F&&F.setColor(E);var L=O.getStroke();L&&(L.setColor(E),L.setLineDash(null)),O.setText(void 0);var D=R.getImage();if(D&&D.getOpacity()!==0){var P=D.getImageSize();if(!P)continue;var k=Ct(P[0],P[1],void 0,{alpha:!1}),H=k.canvas;k.fillStyle=E,k.fillRect(0,0,H.width,H.height),O.setImage(new Fn({img:H,imgSize:P,anchor:D.getAnchor(),anchorXUnits:gt.PIXELS,anchorYUnits:gt.PIXELS,offset:D.getOrigin(),opacity:1,size:D.getSize(),scale:D.getScale(),rotation:D.getRotation(),rotateWithView:D.getRotateWithView()}))}var G=O.getZIndex()||0,A=p[G];A||(A={},p[G]=A,A[w.POLYGON]=[],A[w.CIRCLE]=[],A[w.LINE_STRING]=[],A[w.POINT]=[]),A[T.getType().replace("Multi","")].push(T,O)}}}}}for(var B=Object.keys(p).map(Number).sort(ui),_=0,M=B.length;_<M;++_){var A=p[B[_]];for(var b in A)for(var Y=A[b],S=0,C=Y.length;S<C;S+=2){f.setStyle(Y[S+1]);for(var m=0,st=e.length;m<st;++m)f.setTransform(e[m]),f.drawGeometry(Y[S])}}return h.getImageData(0,0,u.width,u.height)}function Ms(r,e,t){var i=[];if(t){var n=Math.floor(Math.round(r[0])*nt),a=Math.floor(Math.round(r[1])*nt),s=(Wi(n,0,t.width-1)+Wi(a,0,t.height-1)*t.width)*4,o=t.data[s],l=t.data[s+1],h=t.data[s+2],u=h+256*(l+256*o),f=Math.floor((256*256*256-1)/e.length);u&&u%f===0&&i.push(e[u/f-1])}return i}var Ns=.5,Pn={Point:$s,LineString:Ws,Polygon:Vs,MultiPoint:Hs,MultiLineString:Xs,MultiPolygon:Us,GeometryCollection:Ys,Circle:Bs};function ks(r,e){return parseInt(X(r),10)-parseInt(X(e),10)}function bs(r,e){var t=fi(r,e);return t*t}function fi(r,e){return Ns*r/e}function Bs(r,e,t,i,n){var a=t.getFill(),s=t.getStroke();if(a||s){var o=r.getBuilder(t.getZIndex(),N.CIRCLE);o.setFillStrokeStyle(a,s),o.drawCircle(e,i)}var l=t.getText();if(l&&l.getText()){var h=(n||r).getBuilder(t.getZIndex(),N.TEXT);h.setTextStyle(l),h.drawText(e,i)}}function Qi(r,e,t,i,n,a,s){var o=!1,l=t.getImage();if(l){var h=l.getImageState();h==j.LOADED||h==j.ERROR?l.unlistenImageChange(n):(h==j.IDLE&&l.load(),h=l.getImageState(),l.listenImageChange(n),o=!0)}return Gs(r,e,t,i,a,s),o}function Gs(r,e,t,i,n,a){var s=t.getGeometryFunction()(e);if(!!s){var o=s.simplifyTransformed(i,n),l=t.getRenderer();if(l)An(r,o,t,e);else{var h=Pn[o.getType()];h(r,o,t,e,a)}}}function An(r,e,t,i){if(e.getType()==w.GEOMETRY_COLLECTION){for(var n=e.getGeometries(),a=0,s=n.length;a<s;++a)An(r,n[a],t,i);return}var o=r.getBuilder(t.getZIndex(),N.DEFAULT);o.drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer())}function Ys(r,e,t,i,n){var a=e.getGeometriesArray(),s,o;for(s=0,o=a.length;s<o;++s){var l=Pn[a[s].getType()];l(r,a[s],t,i,n)}}function Ws(r,e,t,i,n){var a=t.getStroke();if(a){var s=r.getBuilder(t.getZIndex(),N.LINE_STRING);s.setFillStrokeStyle(null,a),s.drawLineString(e,i)}var o=t.getText();if(o&&o.getText()){var l=(n||r).getBuilder(t.getZIndex(),N.TEXT);l.setTextStyle(o),l.drawText(e,i)}}function Xs(r,e,t,i,n){var a=t.getStroke();if(a){var s=r.getBuilder(t.getZIndex(),N.LINE_STRING);s.setFillStrokeStyle(null,a),s.drawMultiLineString(e,i)}var o=t.getText();if(o&&o.getText()){var l=(n||r).getBuilder(t.getZIndex(),N.TEXT);l.setTextStyle(o),l.drawText(e,i)}}function Us(r,e,t,i,n){var a=t.getFill(),s=t.getStroke();if(s||a){var o=r.getBuilder(t.getZIndex(),N.POLYGON);o.setFillStrokeStyle(a,s),o.drawMultiPolygon(e,i)}var l=t.getText();if(l&&l.getText()){var h=(n||r).getBuilder(t.getZIndex(),N.TEXT);h.setTextStyle(l),h.drawText(e,i)}}function $s(r,e,t,i,n){var a=t.getImage(),s=t.getText(),o;if(n&&(r=n,o=a&&s&&s.getText()?{}:void 0),a){if(a.getImageState()!=j.LOADED)return;var l=r.getBuilder(t.getZIndex(),N.IMAGE);l.setImageStyle(a,o),l.drawPoint(e,i)}if(s&&s.getText()){var h=r.getBuilder(t.getZIndex(),N.TEXT);h.setTextStyle(s,o),h.drawText(e,i)}}function Hs(r,e,t,i,n){var a=t.getImage(),s=t.getText(),o;if(n&&(r=n,o=a&&s&&s.getText()?{}:void 0),a){if(a.getImageState()!=j.LOADED)return;var l=r.getBuilder(t.getZIndex(),N.IMAGE);l.setImageStyle(a,o),l.drawMultiPoint(e,i)}if(s&&s.getText()){var h=(n||r).getBuilder(t.getZIndex(),N.TEXT);h.setTextStyle(s,o),h.drawText(e,i)}}function Vs(r,e,t,i,n){var a=t.getFill(),s=t.getStroke();if(a||s){var o=r.getBuilder(t.getZIndex(),N.POLYGON);o.setFillStrokeStyle(a,s),o.drawPolygon(e,i)}var l=t.getText();if(l&&l.getText()){var h=(n||r).getBuilder(t.getZIndex(),N.TEXT);h.setTextStyle(l),h.drawText(e,i)}}var js=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),zs=function(r){js(e,r);function e(t){var i=r.call(this,t)||this;return i.boundHandleStyleImageChange_=i.handleStyleImageChange_.bind(i),i.animatingOrInteracting_,i.dirty_=!1,i.hitDetectionImageData_=null,i.renderedFeatures_=null,i.renderedRevision_=-1,i.renderedResolution_=NaN,i.renderedExtent_=Pe(),i.wrappedRenderedExtent_=Pe(),i.renderedRotation_,i.renderedCenter_=null,i.renderedProjection_=null,i.renderedRenderOrder_=null,i.replayGroup_=null,i.replayGroupChanged=!0,i.declutterExecutorGroup=null,i.clipping=!0,i}return e.prototype.renderWorlds=function(t,i,n){var a=i.extent,s=i.viewState,o=s.center,l=s.resolution,h=s.projection,u=s.rotation,f=h.getExtent(),c=this.getLayer().getSource(),d=i.pixelRatio,p=i.viewHints,_=!(p[ve.ANIMATING]||p[ve.INTERACTING]),v=this.context,g=Math.round(i.size[0]*d),y=Math.round(i.size[1]*d),x=c.getWrapX()&&h.canWrapX(),E=x?ge(f):null,S=x?Math.ceil((a[2]-f[2])/E)+1:1,C=x?Math.floor((a[0]-f[0])/E):0;do{var R=this.getRenderTransform(o,l,u,d,g,y,C*E);t.execute(v,1,R,u,_,void 0,n)}while(++C<S)},e.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},e.prototype.renderFrame=function(t,i){var n=t.pixelRatio,a=t.layerStatesArray[t.layerIndex];$r(this.pixelTransform,1/n,1/n),Hr(this.inversePixelTransform,this.pixelTransform);var s=Vr(this.pixelTransform);this.useContainer(i,s,a.opacity,this.getBackground(t));var o=this.context,l=o.canvas,h=this.replayGroup_,u=this.declutterExecutorGroup;if((!h||h.isEmpty())&&(!u||u.isEmpty()))return null;var f=Math.round(t.size[0]*n),c=Math.round(t.size[1]*n);l.width!=f||l.height!=c?(l.width=f,l.height=c,l.style.transform!==s&&(l.style.transform=s)):this.containerReused||o.clearRect(0,0,f,c),this.preRender(o,t);var d=t.viewState;d.projection;var p=!1,_=!0;if(a.extent&&this.clipping){var v=jr(a.extent);_=it(v,t.extent),p=_&&!At(v,t.extent),p&&this.clipUnrotated(o,t,v)}_&&this.renderWorlds(h,t),p&&o.restore(),this.postRender(o,t);var g=zr(a.opacity),y=this.container;return g!==y.style.opacity&&(y.style.opacity=g),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container},e.prototype.getFeatures=function(t){return new Promise(function(i){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];Ft(this.pixelTransform,n);var a=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,l=this.renderedProjection_,h=this.wrappedRenderedExtent_,u=this.getLayer(),f=[],c=n[0]*nt,d=n[1]*nt;f.push(this.getRenderTransform(a,s,o,nt,c,d,0).slice());var p=u.getSource(),_=l.getExtent();if(p.getWrapX()&&l.canWrapX()&&!At(_,h)){for(var v=h[0],g=ge(_),y=0,x=void 0;v<_[0];)--y,x=g*y,f.push(this.getRenderTransform(a,s,o,nt,c,d,x).slice()),v+=g;for(y=0,v=h[2];v>_[2];)++y,x=g*y,f.push(this.getRenderTransform(a,s,o,nt,c,d,x).slice()),v-=g}this.hitDetectionImageData_=As(n,f,this.renderedFeatures_,u.getStyleFunction(),h,s,o)}i(Ms(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},e.prototype.forEachFeatureAtCoordinate=function(t,i,n,a,s){var o=this;if(!!this.replayGroup_){var l=i.viewState.resolution,h=i.viewState.rotation,u=this.getLayer(),f={},c=function(_,v,g){var y=X(_),x=f[y];if(x){if(x!==!0&&g<x.distanceSq){if(g===0)return f[y]=!0,s.splice(s.lastIndexOf(x),1),a(_,u,v);x.geometry=v,x.distanceSq=g}}else{if(g===0)return f[y]=!0,a(_,u,v);s.push(f[y]={feature:_,layer:u,geometry:v,distanceSq:g,callback:a})}},d,p=[this.replayGroup_];return this.declutterExecutorGroup&&p.push(this.declutterExecutorGroup),p.some(function(_){return d=_.forEachFeatureAtCoordinate(t,l,h,n,c,_===o.declutterExecutorGroup&&i.declutterTree?i.declutterTree.all().map(function(v){return v.value}):null)}),d}},e.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},e.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},e.prototype.prepareFrame=function(t){var i=this.getLayer(),n=i.getSource();if(!n)return!1;var a=t.viewHints[ve.ANIMATING],s=t.viewHints[ve.INTERACTING],o=i.getUpdateWhileAnimating(),l=i.getUpdateWhileInteracting();if(!this.dirty_&&!o&&a||!l&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var h=t.extent,u=t.viewState,f=u.projection,c=u.resolution,d=t.pixelRatio,p=i.getRevision(),_=i.getRenderBuffer(),v=i.getRenderOrder();v===void 0&&(v=ks);var g=u.center.slice(),y=pi(h,_*c),x=y.slice(),E=[y.slice()],S=f.getExtent();if(n.getWrapX()&&f.canWrapX()&&!At(S,t.extent)){var C=ge(S),R=Math.max(ge(y)/2,C);y[0]=S[0]-R,y[2]=S[2]+R,Jr(g,f);var T=qr(E[0],f);T[0]<S[0]&&T[2]<S[2]?E.push([T[0]+C,T[1],T[2]+C,T[3]]):T[0]>S[0]&&T[2]>S[2]&&E.push([T[0]-C,T[1],T[2]-C,T[3]])}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==p&&this.renderedRenderOrder_==v&&At(this.wrappedRenderedExtent_,y))return Ne(this.renderedExtent_,x)||(this.hitDetectionImageData_=null,this.renderedExtent_=x),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var O=new Ji(fi(c,d),y,c,d),F;this.getLayer().getDeclutter()&&(F=new Ji(fi(c,d),y,c,d));for(var L,D,P,D=0,P=E.length;D<P;++D)n.loadFeatures(E[D],c,f);var k=bs(c,d),H=function(b){var Y,m=b.getStyleFunction()||i.getStyleFunction();if(m&&(Y=m(b,c)),Y){var st=this.renderFeature(b,k,Y,O,L,F);this.dirty_=this.dirty_||st}}.bind(this),G=Zr(y),A=n.getFeaturesInExtent(G);v&&A.sort(v);for(var D=0,P=A.length;D<P;++D)H(A[D]);this.renderedFeatures_=A;var B=O.finish(),M=new Zi(y,c,d,n.getOverlaps(),B,i.getRenderBuffer());return F&&(this.declutterExecutorGroup=new Zi(y,c,d,n.getOverlaps(),F.finish(),i.getRenderBuffer())),this.renderedResolution_=c,this.renderedRevision_=p,this.renderedRenderOrder_=v,this.renderedExtent_=x,this.wrappedRenderedExtent_=y,this.renderedCenter_=g,this.renderedProjection_=f,this.replayGroup_=M,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},e.prototype.renderFeature=function(t,i,n,a,s,o){if(!n)return!1;var l=!1;if(Array.isArray(n))for(var h=0,u=n.length;h<u;++h)l=Qi(a,t,n[h],i,this.boundHandleStyleImageChange_,s,o)||l;else l=Qi(a,t,n,i,this.boundHandleStyleImageChange_,s,o);return l},e}(Kr),Js=zs,qs=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ks=function(r){qs(e,r);function e(t){return r.call(this,t)||this}return e.prototype.createRenderer=function(){return new Js(this)},e}(ts),Zs=Ks,Qs=function(){function r(e){this.rbush_=new Tn(e),this.items_={}}return r.prototype.insert=function(e,t){var i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[X(t)]=i},r.prototype.load=function(e,t){for(var i=new Array(t.length),n=0,a=t.length;n<a;n++){var s=e[n],o=t[n],l={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:o};i[n]=l,this.items_[X(o)]=l}this.rbush_.load(i)},r.prototype.remove=function(e){var t=X(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null},r.prototype.update=function(e,t){var i=this.items_[X(t)],n=[i.minX,i.minY,i.maxX,i.maxY];yn(n,e)||(this.remove(t),this.insert(e,t))},r.prototype.getAll=function(){var e=this.rbush_.all();return e.map(function(t){return t.value})},r.prototype.getInExtent=function(e){var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]},i=this.rbush_.search(t);return i.map(function(n){return n.value})},r.prototype.forEach=function(e){return this.forEach_(this.getAll(),e)},r.prototype.forEachInExtent=function(e,t){return this.forEach_(this.getInExtent(e),t)},r.prototype.forEach_=function(e,t){for(var i,n=0,a=e.length;n<a;n++)if(i=t(e[n]),i)return i;return i},r.prototype.isEmpty=function(){return Ae(this.items_)},r.prototype.clear=function(){this.rbush_.clear(),this.items_={}},r.prototype.getExtent=function(e){var t=this.rbush_.toJSON();return hi(t.minX,t.minY,t.maxX,t.maxY,e)},r.prototype.concat=function(e){this.rbush_.load(e.rbush_.all());for(var t in e.items_)this.items_[t]=e.items_[t]},r}(),tn=Qs,et={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function to(r,e){return[[-1/0,-1/0,1/0,1/0]]}var eo=!1;function io(r,e,t,i,n,a,s){var o=new XMLHttpRequest;o.open("GET",typeof r=="function"?r(t,i,n):r,!0),e.getType()==Ht.ARRAY_BUFFER&&(o.responseType="arraybuffer"),o.withCredentials=eo,o.onload=function(l){if(!o.status||o.status>=200&&o.status<300){var h=e.getType(),u=void 0;h==Ht.JSON||h==Ht.TEXT?u=o.responseText:h==Ht.XML?(u=o.responseXML,u||(u=new DOMParser().parseFromString(o.responseText,"application/xml"))):h==Ht.ARRAY_BUFFER&&(u=o.response),u?a(e.readFeatures(u,{extent:t,featureProjection:n}),e.readProjection(u)):s()}else s()},o.onerror=s,o.send()}function en(r,e){return function(t,i,n,a,s){var o=this;io(r,e,t,i,n,function(l,h){o.addFeatures(l),a!==void 0&&a(l)},s||mn)}}var Mn=globalThis&&globalThis.__extends||function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,n){i.__proto__=n}||function(i,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(i[a]=n[a])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}}(),_t=function(r){Mn(e,r);function e(t,i,n){var a=r.call(this,t)||this;return a.feature=i,a.features=n,a}return e}(Qr),no=function(r){Mn(e,r);function e(t){var i=this,n=t||{};i=r.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:ta.READY,wrapX:n.wrapX!==void 0?n.wrapX:!0})||this,i.on,i.once,i.un,i.loader_=mn,i.format_=n.format,i.overlaps_=n.overlaps===void 0?!0:n.overlaps,i.url_=n.url,n.loader!==void 0?i.loader_=n.loader:i.url_!==void 0&&(mt(i.format_,7),i.loader_=en(i.url_,i.format_)),i.strategy_=n.strategy!==void 0?n.strategy:to;var a=n.useSpatialIndex!==void 0?n.useSpatialIndex:!0;i.featuresRtree_=a?new tn:null,i.loadedExtentsRtree_=new tn,i.loadingExtentsCount_=0,i.nullGeometryFeatures_={},i.idIndex_={},i.uidIndex_={},i.featureChangeKeys_={},i.featuresCollection_=null;var s,o;return Array.isArray(n.features)?o=n.features:n.features&&(s=n.features,o=s.getArray()),!a&&s===void 0&&(s=new ea(o)),o!==void 0&&i.addFeaturesInternal(o),s!==void 0&&i.bindFeaturesCollection_(s),i}return e.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},e.prototype.addFeatureInternal=function(t){var i=X(t);if(!this.addToIndex_(i,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(i,t);var n=t.getGeometry();if(n){var a=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(a,t)}else this.nullGeometryFeatures_[i]=t;this.dispatchEvent(new _t(et.ADDFEATURE,t))},e.prototype.setupChangeEvents_=function(t,i){this.featureChangeKeys_[t]=[Re(i,Zt.CHANGE,this.handleFeatureChange_,this),Re(i,ia.PROPERTYCHANGE,this.handleFeatureChange_,this)]},e.prototype.addToIndex_=function(t,i){var n=!0,a=i.getId();return a!==void 0&&(a.toString()in this.idIndex_?n=!1:this.idIndex_[a.toString()]=i),n&&(mt(!(t in this.uidIndex_),30),this.uidIndex_[t]=i),n},e.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},e.prototype.addFeaturesInternal=function(t){for(var i=[],n=[],a=[],s=0,o=t.length;s<o;s++){var l=t[s],h=X(l);this.addToIndex_(h,l)&&n.push(l)}for(var s=0,u=n.length;s<u;s++){var l=n[s],h=X(l);this.setupChangeEvents_(h,l);var f=l.getGeometry();if(f){var c=f.getExtent();i.push(c),a.push(l)}else this.nullGeometryFeatures_[h]=l}this.featuresRtree_&&this.featuresRtree_.load(i,a);for(var s=0,d=n.length;s<d;s++)this.dispatchEvent(new _t(et.ADDFEATURE,n[s]))},e.prototype.bindFeaturesCollection_=function(t){var i=!1;this.addEventListener(et.ADDFEATURE,function(n){i||(i=!0,t.push(n.feature),i=!1)}),this.addEventListener(et.REMOVEFEATURE,function(n){i||(i=!0,t.remove(n.feature),i=!1)}),t.addEventListener(Xi.ADD,function(n){i||(i=!0,this.addFeature(n.element),i=!1)}.bind(this)),t.addEventListener(Xi.REMOVE,function(n){i||(i=!0,this.removeFeature(n.element),i=!1)}.bind(this)),this.featuresCollection_=t},e.prototype.clear=function(t){if(t){for(var i in this.featureChangeKeys_){var n=this.featureChangeKeys_[i];n.forEach(Oe)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var a=function(l){this.removeFeatureInternal(l)}.bind(this);this.featuresRtree_.forEach(a);for(var s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var o=new _t(et.CLEAR);this.dispatchEvent(o),this.changed()},e.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},e.prototype.forEachFeatureAtCoordinateDirect=function(t,i){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(a){var s=a.getGeometry();if(s.intersectsCoordinate(t))return i(a)})},e.prototype.forEachFeatureInExtent=function(t,i){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,i);this.featuresCollection_&&this.featuresCollection_.forEach(i)},e.prototype.forEachFeatureIntersectingExtent=function(t,i){return this.forEachFeatureInExtent(t,function(n){var a=n.getGeometry();if(a.intersectsExtent(t)){var s=i(n);if(s)return s}})},e.prototype.getFeaturesCollection=function(){return this.featuresCollection_},e.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Ae(this.nullGeometryFeatures_)||_n(t,na(this.nullGeometryFeatures_))),t},e.prototype.getFeaturesAtCoordinate=function(t){var i=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){i.push(n)}),i},e.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},e.prototype.getClosestFeatureToCoordinate=function(t,i){var n=t[0],a=t[1],s=null,o=[NaN,NaN],l=1/0,h=[-1/0,-1/0,1/0,1/0],u=i||aa;return this.featuresRtree_.forEachInExtent(h,function(f){if(u(f)){var c=f.getGeometry(),d=l;if(l=c.closestPointXY(n,a,o,l),l<d){s=f;var p=Math.sqrt(l);h[0]=n-p,h[1]=a-p,h[2]=n+p,h[3]=a+p}}}),s},e.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},e.prototype.getFeatureById=function(t){var i=this.idIndex_[t.toString()];return i!==void 0?i:null},e.prototype.getFeatureByUid=function(t){var i=this.uidIndex_[t];return i!==void 0?i:null},e.prototype.getFormat=function(){return this.format_},e.prototype.getOverlaps=function(){return this.overlaps_},e.prototype.getUrl=function(){return this.url_},e.prototype.handleFeatureChange_=function(t){var i=t.target,n=X(i),a=i.getGeometry();if(!a)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(i),this.nullGeometryFeatures_[n]=i);else{var s=a.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(s,i)):this.featuresRtree_&&this.featuresRtree_.update(s,i)}var o=i.getId();if(o!==void 0){var l=o.toString();this.idIndex_[l]!==i&&(this.removeFromIdIndex_(i),this.idIndex_[l]=i)}else this.removeFromIdIndex_(i),this.uidIndex_[n]=i;this.changed(),this.dispatchEvent(new _t(et.CHANGEFEATURE,i))},e.prototype.hasFeature=function(t){var i=t.getId();return i!==void 0?i in this.idIndex_:X(t)in this.uidIndex_},e.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&Ae(this.nullGeometryFeatures_)},e.prototype.loadFeatures=function(t,i,n){for(var a=this.loadedExtentsRtree_,s=this.strategy_(t,i,n),o=function(f,c){var d=s[f],p=a.forEachInExtent(d,function(_){return At(_.extent,d)});p||(++l.loadingExtentsCount_,l.dispatchEvent(new _t(et.FEATURESLOADSTART)),l.loader_.call(l,d,i,n,function(_){--this.loadingExtentsCount_,this.dispatchEvent(new _t(et.FEATURESLOADEND,void 0,_))}.bind(l),function(){--this.loadingExtentsCount_,this.dispatchEvent(new _t(et.FEATURESLOADERROR))}.bind(l)),a.insert(d,{extent:d.slice()}))},l=this,h=0,u=s.length;h<u;++h)o(h);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},e.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),r.prototype.refresh.call(this)},e.prototype.removeLoadedExtent=function(t){var i=this.loadedExtentsRtree_,n;i.forEachInExtent(t,function(a){if(yn(a.extent,t))return n=a,!0}),n&&i.remove(n)},e.prototype.removeFeature=function(t){if(!!t){var i=X(t);i in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[i]:this.featuresRtree_&&this.featuresRtree_.remove(t);var n=this.removeFeatureInternal(t);n&&this.changed()}},e.prototype.removeFeatureInternal=function(t){var i=X(t),n=this.featureChangeKeys_[i];if(!!n){n.forEach(Oe),delete this.featureChangeKeys_[i];var a=t.getId();return a!==void 0&&delete this.idIndex_[a.toString()],delete this.uidIndex_[i],this.dispatchEvent(new _t(et.REMOVEFEATURE,t)),t}},e.prototype.removeFromIdIndex_=function(t){var i=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],i=!0;break}return i},e.prototype.setLoader=function(t){this.loader_=t},e.prototype.setUrl=function(t){mt(this.format_,7),this.url_=t,this.setLoader(en(t,this.format_))},e}(ra),ro=no,vi={exports:{}},Nn=function(e,t){return function(){for(var n=new Array(arguments.length),a=0;a<n.length;a++)n[a]=arguments[a];return e.apply(t,n)}},ao=Nn,xt=Object.prototype.toString;function gi(r){return Array.isArray(r)}function ci(r){return typeof r=="undefined"}function so(r){return r!==null&&!ci(r)&&r.constructor!==null&&!ci(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function kn(r){return xt.call(r)==="[object ArrayBuffer]"}function oo(r){return xt.call(r)==="[object FormData]"}function lo(r){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&kn(r.buffer),e}function ho(r){return typeof r=="string"}function uo(r){return typeof r=="number"}function bn(r){return r!==null&&typeof r=="object"}function Ie(r){if(xt.call(r)!=="[object Object]")return!1;var e=Object.getPrototypeOf(r);return e===null||e===Object.prototype}function fo(r){return xt.call(r)==="[object Date]"}function co(r){return xt.call(r)==="[object File]"}function po(r){return xt.call(r)==="[object Blob]"}function Bn(r){return xt.call(r)==="[object Function]"}function _o(r){return bn(r)&&Bn(r.pipe)}function vo(r){return xt.call(r)==="[object URLSearchParams]"}function go(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function yo(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function yi(r,e){if(!(r===null||typeof r=="undefined"))if(typeof r!="object"&&(r=[r]),gi(r))for(var t=0,i=r.length;t<i;t++)e.call(null,r[t],t,r);else for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.call(null,r[n],n,r)}function di(){var r={};function e(n,a){Ie(r[a])&&Ie(n)?r[a]=di(r[a],n):Ie(n)?r[a]=di({},n):gi(n)?r[a]=n.slice():r[a]=n}for(var t=0,i=arguments.length;t<i;t++)yi(arguments[t],e);return r}function mo(r,e,t){return yi(e,function(n,a){t&&typeof n=="function"?r[a]=ao(n,t):r[a]=n}),r}function xo(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r}var z={isArray:gi,isArrayBuffer:kn,isBuffer:so,isFormData:oo,isArrayBufferView:lo,isString:ho,isNumber:uo,isObject:bn,isPlainObject:Ie,isUndefined:ci,isDate:fo,isFile:co,isBlob:po,isFunction:Bn,isStream:_o,isURLSearchParams:vo,isStandardBrowserEnv:yo,forEach:yi,merge:di,extend:mo,trim:go,stripBOM:xo},Lt=z;function nn(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Gn=function(e,t,i){if(!t)return e;var n;if(i)n=i(t);else if(Lt.isURLSearchParams(t))n=t.toString();else{var a=[];Lt.forEach(t,function(l,h){l===null||typeof l=="undefined"||(Lt.isArray(l)?h=h+"[]":l=[l],Lt.forEach(l,function(f){Lt.isDate(f)?f=f.toISOString():Lt.isObject(f)&&(f=JSON.stringify(f)),a.push(nn(h)+"="+nn(f))}))}),n=a.join("&")}if(n){var s=e.indexOf("#");s!==-1&&(e=e.slice(0,s)),e+=(e.indexOf("?")===-1?"?":"&")+n}return e},Eo=z;function be(){this.handlers=[]}be.prototype.use=function(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1};be.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)};be.prototype.forEach=function(e){Eo.forEach(this.handlers,function(i){i!==null&&e(i)})};var So=be,Io=z,To=function(e,t){Io.forEach(e,function(n,a){a!==t&&a.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[a])})},Yn=function(e,t,i,n,a){return e.config=t,i&&(e.code=i),e.request=n,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},Co=Yn,Wn=function(e,t,i,n,a){var s=new Error(e);return Co(s,t,i,n,a)},Oo=Wn,Ro=function(e,t,i){var n=i.config.validateStatus;!i.status||!n||n(i.status)?e(i):t(Oo("Request failed with status code "+i.status,i.config,null,i.request,i))},Ee=z,wo=Ee.isStandardBrowserEnv()?function(){return{write:function(t,i,n,a,s,o){var l=[];l.push(t+"="+encodeURIComponent(i)),Ee.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),Ee.isString(a)&&l.push("path="+a),Ee.isString(s)&&l.push("domain="+s),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(t){var i=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Lo=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Do=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},Fo=Lo,Po=Do,Ao=function(e,t){return e&&!Fo(t)?Po(e,t):t},ai=z,Mo=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],No=function(e){var t={},i,n,a;return e&&ai.forEach(e.split(`
`),function(o){if(a=o.indexOf(":"),i=ai.trim(o.substr(0,a)).toLowerCase(),n=ai.trim(o.substr(a+1)),i){if(t[i]&&Mo.indexOf(i)>=0)return;i==="set-cookie"?t[i]=(t[i]?t[i]:[]).concat([n]):t[i]=t[i]?t[i]+", "+n:n}}),t},rn=z,ko=rn.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),i;function n(a){var s=a;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=n(window.location.href),function(s){var o=rn.isString(s)?n(s):s;return o.protocol===i.protocol&&o.host===i.host}}():function(){return function(){return!0}}();function mi(r){this.message=r}mi.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};mi.prototype.__CANCEL__=!0;var Be=mi,Se=z,bo=Ro,Bo=wo,Go=Gn,Yo=Ao,Wo=No,Xo=ko,si=Wn,Uo=Ye,$o=Be,an=function(e){return new Promise(function(i,n){var a=e.data,s=e.headers,o=e.responseType,l;function h(){e.cancelToken&&e.cancelToken.unsubscribe(l),e.signal&&e.signal.removeEventListener("abort",l)}Se.isFormData(a)&&delete s["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",c=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";s.Authorization="Basic "+btoa(f+":"+c)}var d=Yo(e.baseURL,e.url);u.open(e.method.toUpperCase(),Go(d,e.params,e.paramsSerializer),!0),u.timeout=e.timeout;function p(){if(!!u){var v="getAllResponseHeaders"in u?Wo(u.getAllResponseHeaders()):null,g=!o||o==="text"||o==="json"?u.responseText:u.response,y={data:g,status:u.status,statusText:u.statusText,headers:v,config:e,request:u};bo(function(E){i(E),h()},function(E){n(E),h()},y),u=null}}if("onloadend"in u?u.onloadend=p:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(p)},u.onabort=function(){!u||(n(si("Request aborted",e,"ECONNABORTED",u)),u=null)},u.onerror=function(){n(si("Network Error",e,null,u)),u=null},u.ontimeout=function(){var g=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",y=e.transitional||Uo.transitional;e.timeoutErrorMessage&&(g=e.timeoutErrorMessage),n(si(g,e,y.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",u)),u=null},Se.isStandardBrowserEnv()){var _=(e.withCredentials||Xo(d))&&e.xsrfCookieName?Bo.read(e.xsrfCookieName):void 0;_&&(s[e.xsrfHeaderName]=_)}"setRequestHeader"in u&&Se.forEach(s,function(g,y){typeof a=="undefined"&&y.toLowerCase()==="content-type"?delete s[y]:u.setRequestHeader(y,g)}),Se.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),o&&o!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(l=function(v){!u||(n(!v||v&&v.type?new $o("canceled"):v),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(l),e.signal&&(e.signal.aborted?l():e.signal.addEventListener("abort",l))),a||(a=null),u.send(a)})},W=z,sn=To,Ho=Yn,Vo={"Content-Type":"application/x-www-form-urlencoded"};function on(r,e){!W.isUndefined(r)&&W.isUndefined(r["Content-Type"])&&(r["Content-Type"]=e)}function jo(){var r;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(r=an),r}function zo(r,e,t){if(W.isString(r))try{return(e||JSON.parse)(r),W.trim(r)}catch(i){if(i.name!=="SyntaxError")throw i}return(t||JSON.stringify)(r)}var Ge={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:jo(),transformRequest:[function(e,t){return sn(t,"Accept"),sn(t,"Content-Type"),W.isFormData(e)||W.isArrayBuffer(e)||W.isBuffer(e)||W.isStream(e)||W.isFile(e)||W.isBlob(e)?e:W.isArrayBufferView(e)?e.buffer:W.isURLSearchParams(e)?(on(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):W.isObject(e)||t&&t["Content-Type"]==="application/json"?(on(t,"application/json"),zo(e)):e}],transformResponse:[function(e){var t=this.transitional||Ge.transitional,i=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,a=!i&&this.responseType==="json";if(a||n&&W.isString(e)&&e.length)try{return JSON.parse(e)}catch(s){if(a)throw s.name==="SyntaxError"?Ho(s,this,"E_JSON_PARSE"):s}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};W.forEach(["delete","get","head"],function(e){Ge.headers[e]={}});W.forEach(["post","put","patch"],function(e){Ge.headers[e]=W.merge(Vo)});var Ye=Ge,Jo=z,qo=Ye,Ko=function(e,t,i){var n=this||qo;return Jo.forEach(i,function(s){e=s.call(n,e,t)}),e},Xn=function(e){return!!(e&&e.__CANCEL__)},ln=z,oi=Ko,Zo=Xn,Qo=Ye,tl=Be;function li(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new tl("canceled")}var el=function(e){li(e),e.headers=e.headers||{},e.data=oi.call(e,e.data,e.headers,e.transformRequest),e.headers=ln.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),ln.forEach(["delete","get","head","post","put","patch","common"],function(n){delete e.headers[n]});var t=e.adapter||Qo.adapter;return t(e).then(function(n){return li(e),n.data=oi.call(e,n.data,n.headers,e.transformResponse),n},function(n){return Zo(n)||(li(e),n&&n.response&&(n.response.data=oi.call(e,n.response.data,n.response.headers,e.transformResponse))),Promise.reject(n)})},q=z,Un=function(e,t){t=t||{};var i={};function n(u,f){return q.isPlainObject(u)&&q.isPlainObject(f)?q.merge(u,f):q.isPlainObject(f)?q.merge({},f):q.isArray(f)?f.slice():f}function a(u){if(q.isUndefined(t[u])){if(!q.isUndefined(e[u]))return n(void 0,e[u])}else return n(e[u],t[u])}function s(u){if(!q.isUndefined(t[u]))return n(void 0,t[u])}function o(u){if(q.isUndefined(t[u])){if(!q.isUndefined(e[u]))return n(void 0,e[u])}else return n(void 0,t[u])}function l(u){if(u in t)return n(e[u],t[u]);if(u in e)return n(void 0,e[u])}var h={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l};return q.forEach(Object.keys(e).concat(Object.keys(t)),function(f){var c=h[f]||a,d=c(f);q.isUndefined(d)&&c!==l||(i[f]=d)}),i},$n={version:"0.26.0"},il=$n.version,xi={};["object","boolean","number","function","string","symbol"].forEach(function(r,e){xi[r]=function(i){return typeof i===r||"a"+(e<1?"n ":" ")+r}});var hn={};xi.transitional=function(e,t,i){function n(a,s){return"[Axios v"+il+"] Transitional option '"+a+"'"+s+(i?". "+i:"")}return function(a,s,o){if(e===!1)throw new Error(n(s," has been removed"+(t?" in "+t:"")));return t&&!hn[s]&&(hn[s]=!0,console.warn(n(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(a,s,o):!0}};function nl(r,e,t){if(typeof r!="object")throw new TypeError("options must be an object");for(var i=Object.keys(r),n=i.length;n-- >0;){var a=i[n],s=e[a];if(s){var o=r[a],l=o===void 0||s(o,a,r);if(l!==!0)throw new TypeError("option "+a+" must be "+l);continue}if(t!==!0)throw Error("Unknown option "+a)}}var rl={assertOptions:nl,validators:xi},Hn=z,al=Gn,un=So,fn=el,We=Un,Vn=rl,Dt=Vn.validators;function oe(r){this.defaults=r,this.interceptors={request:new un,response:new un}}oe.prototype.request=function(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=We(this.defaults,t),t.method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var i=t.transitional;i!==void 0&&Vn.assertOptions(i,{silentJSONParsing:Dt.transitional(Dt.boolean),forcedJSONParsing:Dt.transitional(Dt.boolean),clarifyTimeoutError:Dt.transitional(Dt.boolean)},!1);var n=[],a=!0;this.interceptors.request.forEach(function(d){typeof d.runWhen=="function"&&d.runWhen(t)===!1||(a=a&&d.synchronous,n.unshift(d.fulfilled,d.rejected))});var s=[];this.interceptors.response.forEach(function(d){s.push(d.fulfilled,d.rejected)});var o;if(!a){var l=[fn,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(s),o=Promise.resolve(t);l.length;)o=o.then(l.shift(),l.shift());return o}for(var h=t;n.length;){var u=n.shift(),f=n.shift();try{h=u(h)}catch(c){f(c);break}}try{o=fn(h)}catch(c){return Promise.reject(c)}for(;s.length;)o=o.then(s.shift(),s.shift());return o};oe.prototype.getUri=function(e){return e=We(this.defaults,e),al(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};Hn.forEach(["delete","get","head","options"],function(e){oe.prototype[e]=function(t,i){return this.request(We(i||{},{method:e,url:t,data:(i||{}).data}))}});Hn.forEach(["post","put","patch"],function(e){oe.prototype[e]=function(t,i,n){return this.request(We(n||{},{method:e,url:t,data:i}))}});var sl=oe,ol=Be;function kt(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(n){e=n});var t=this;this.promise.then(function(i){if(!!t._listeners){var n,a=t._listeners.length;for(n=0;n<a;n++)t._listeners[n](i);t._listeners=null}}),this.promise.then=function(i){var n,a=new Promise(function(s){t.subscribe(s),n=s}).then(i);return a.cancel=function(){t.unsubscribe(n)},a},r(function(n){t.reason||(t.reason=new ol(n),e(t.reason))})}kt.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};kt.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]};kt.prototype.unsubscribe=function(e){if(!!this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}};kt.source=function(){var e,t=new kt(function(n){e=n});return{token:t,cancel:e}};var ll=kt,hl=function(e){return function(i){return e.apply(null,i)}},ul=z,fl=function(e){return ul.isObject(e)&&e.isAxiosError===!0},cn=z,cl=Nn,Te=sl,dl=Un,pl=Ye;function jn(r){var e=new Te(r),t=cl(Te.prototype.request,e);return cn.extend(t,Te.prototype,e),cn.extend(t,e),t.create=function(n){return jn(dl(r,n))},t}var at=jn(pl);at.Axios=Te;at.Cancel=Be;at.CancelToken=ll;at.isCancel=Xn;at.VERSION=$n.version;at.all=function(e){return Promise.all(e)};at.spread=hl;at.isAxiosError=fl;vi.exports=at;vi.exports.default=at;var _l=vi.exports;const Ei=_l.create({timeout:5e3});Ei.interceptors.request.use(r=>r,r=>Promise.reject(r));Ei.interceptors.response.use(r=>r,r=>(ca.error(r.message),Promise.reject(r)));const vl=()=>Ei({url:"/typhoonData.json"}),gl=(r,e)=>{const t=[r[e].lng,r[e].lat],i=new ke({geometry:new xn(Nt(t))});return i.setStyle(new Ln({image:new On({fill:new Rn({color:El(r[e].strong)}),radius:5})})),i.set("typhoonPoint",!0),i.set("points",r[e]),i},yl=(r,e)=>{const t=[r[e].lng,r[e].lat],i=[r[e-1].lng,r[e-1].lat],n=new ke({geometry:new Aa([Nt(t),Nt(i)])});return n.set("typhoonLine",!0),n},ml=r=>{let e=r.radius7.split("|").map(s=>parseFloat(s)),t={CIRCLE_CENTER_X:parseFloat(r.lng),CIRCLE_CENTER_Y:parseFloat(r.lat),CIRCLE_R:{SE:e[0]/100,NE:e[1]/100,NW:e[2]/100,SW:e[3]/100}},i=[],n=6;for(let s=0;s<360/n;s++){let o=0,l=s*n;l>0&&l<=90?o=t.CIRCLE_R.NE:l>90&&l<=180?o=t.CIRCLE_R.NW:l>180&&l<=270?o=t.CIRCLE_R.SW:o=t.CIRCLE_R.SE;let h=t.CIRCLE_CENTER_X+o*Math.cos(l*3.14/180),u=t.CIRCLE_CENTER_Y+o*Math.sin(l*3.14/180);i.push(Nt([h,u]))}let a=new ke({geometry:new sa([i])});return a.set("typhoonSolar",!0),a},xl=(r,e)=>{const t=[r[e].lng,r[e].lat],i=new ke({geometry:new xn(Nt(t))});return i.setStyle(new Ln({image:new Fn({src:"/typhoon.png",scale:.5})})),i},El=r=>({\u70ED\u5E26\u98CE\u66B4:"red",\u70ED\u5E26\u4F4E\u538B:"blue",\u5F3A\u70ED\u5E26\u98CE\u66B4:"purple",\u53F0\u98CE:"orange",\u5F3A\u53F0\u98CE:"yellow",\u8D85\u5F3A\u53F0\u98CE:"salmon"})[r],Sl=(r,e)=>{let t=St(null);const i=new Ca({element:e,autoPan:!0,autoPanAnimation:{duration:250}});return i.setPosition(void 0),t.value=i,console.log(e),r.addOverlay(i),t.value};let Ce=St(null);const Il=(r,e,t)=>{const i=Sl(r,e);r.on("pointermove",n=>{const a=n.pixel,s=r.forEachFeatureAtPixel(a,o=>o);s&&Rl(s)==="typhoonPoint"?(t.value=s.get("points"),dn(),r.getTargetElement().style.cursor="pointer",Tl(t.value,i),s.getStyle().getImage().setRadius(8),s.changed(),Ce.value=s):(dn(),r.getTargetElement().style.cursor="",t.value={},Cl(i))})},Tl=(r,e)=>{const t=Nt([r.lng,r.lat]);e.setPosition(t)},Cl=r=>{r.setPosition(void 0)},Ol=r=>{r.on("click",e=>{const t=e.pixel,i=r.forEachFeatureAtPixel(t,n=>n);i?i.get("typhoonPoint")&&console.log("you click tyhoonPoint!"):console.log("no click feature")})},dn=()=>{Ce.value!=null&&(Ce.value.getStyle().getImage().setRadius(5),Ce.value.changed())},Rl=r=>r.get("typhoonPoint")?"typhoonPoint":r.get("typhoonSolar")?"typhoonSolar":"isFeatureButDontNeedTodo";const wl=r=>(ga("data-v-0b5d8810"),r=r(),ya(),r),Ll=wl(()=>Ui("div",{class:"card-header"},[Ui("span",null,"\u5B9E\u51B5\u53F0\u98CE\u4FE1\u606F")],-1)),Dl={props:{typhoonData:{type:Object},typhoonName:{type:String}},setup(r){return(e,t)=>{const i=da,n=pa,a=_a,s=va;return _i(),En(s,{class:"box-card"},{header:K(()=>[Ll]),default:K(()=>[$(a,{column:2,border:""},{default:K(()=>[$(i,{label:"\u540D\u79F0","label-align":"right",align:"center","label-class-name":"my-label","class-name":"my-content"},{default:K(()=>[Ot(Et(r.typhoonName),1)]),_:1}),$(i,{label:"\u65F6\u95F4","label-align":"right",align:"center"},{default:K(()=>[$(n,{size:"small"},{default:K(()=>[Ot(Et(r.typhoonData.time),1)]),_:1})]),_:1}),$(i,{label:"\u5F3A\u5EA6","label-align":"right",align:"center"},{default:K(()=>[Ot(Et(r.typhoonData.strong),1)]),_:1}),$(i,{label:"\u6C14\u538B","label-align":"right",align:"center"},{default:K(()=>[Ot(Et(r.typhoonData.pressure)+" \u767E\u5E15",1)]),_:1}),$(i,{label:"\u79FB\u901F","label-align":"right",align:"center"},{default:K(()=>[Ot(Et(r.typhoonData.speed)+" \u7C73/\u6BCF\u79D2",1)]),_:1}),$(i,{label:"\u4E2D\u5FC3\u4F4D\u7F6E","label-align":"right",align:"center"},{default:K(()=>[Ot(" \u4E1C\u7ECF: "+Et(r.typhoonData.lng)+",\u5317\u7EAC: "+Et(r.typhoonData.lat),1)]),_:1})]),_:1})]),_:1})}}};var Fl=fa(Dl,[["__scopeId","data-v-0b5d8810"]]);const Pl={setup(r){const e=ma("map"),t=St(""),i=async()=>{const{data:h}=await vl();return t.value=h.name,h};let n=St(null),a=St(null);(async()=>{const{points:h}=await i(),u=new Zs,f=new ro;u.setSource(f);let c=0;const d=setInterval(()=>{if(c==h.length){clearInterval(d);return}const p=gl(h,c);if(f.addFeature(p),c>0){const _=yl(h,c);f.addFeature(_)}if(h[c].radius7.length!=0||h[c].radius7!=null){let _=ml(h[c]);n!=null&&f.removeFeature(n),n=_,f.addFeature(_)}if(c<=h.length-1){let _=xl(h,c),v=a;v!=null&&f.removeFeature(v),a=_,f.addFeature(_)}c++},50);e.addLayer(u)})();let o=St({}),l=St(null);return xa(()=>{Il(e,l.value,o)}),Ol(e),(h,u)=>(_i(),Ea("div",{ref_key:"typhoonInfo",ref:l},[$(Fl,{typhoonData:Sa(o),typhoonName:t.value},null,8,["typhoonData","typhoonName"])],512))}},Al={setup(r){const e=[113.27,23.1],t="http://t{0-7}.tianditu.gov.cn/vec_w/wmts?tk=40e50cca6823476482e8721bb2eee900",i="http://t{0-7}.tianditu.gov.cn/cva_w/wmts?tk=40e50cca6823476482e8721bb2eee900",n="vec",a="cva",s="\u52A0\u8F7DWMTS\u5929\u5730\u56FE";return(o,l)=>{const h=la,u=ha,f=ua,c=oa;return _i(),En(c,null,{default:K(()=>[$(h,{center:e,zoom:5}),$(f,null,{default:K(()=>[$(u,{url:t,attributions:s,layer:n})]),_:1}),$(f,null,{default:K(()=>[$(u,{url:i,attributions:s,layer:a})]),_:1}),$(Pl)]),_:1})}}};var bl=Al;export{bl as default};
